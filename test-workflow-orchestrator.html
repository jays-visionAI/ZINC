<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Workflow Orchestrator Test</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="utils-runtime-resolver.js"></script>
    <script src="utils-brand-brain.js"></script>
    <script src="utils-workflow-orchestrator.js"></script>
    <style>
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #16e0bd;
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #a0a0a0;
        }

        input,
        textarea {
            width: 100%;
            padding: 10px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #fff;
            font-family: monospace;
        }

        button {
            background: #16e0bd;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        button:hover {
            background: #1affdb;
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
        }

        #logs {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
        }

        .log-info {
            color: #3b82f6;
        }

        .log-success {
            color: #22c55e;
        }

        .log-error {
            color: #ef4444;
        }

        .log-warn {
            color: #f59e0b;
        }
    </style>
</head>

<body>
    <h1>üöÄ Workflow Orchestrator Test</h1>

    <div class="section">
        <h2>Test Configuration</h2>
        <div class="form-group">
            <label>Project ID</label>
            <input type="text" id="projectId" value="proj_test_001" placeholder="e.g., proj_test_001">
        </div>
        <div class="form-group">
            <label>Team Instance ID</label>
            <input type="text" id="teamInstanceId" value="team_test_001" placeholder="e.g., team_test_001">
        </div>
        <div class="form-group">
            <label>Workflow Template ID</label>
            <input type="text" id="workflowTemplateId" value="wf_tpl_ig_organic_post"
                placeholder="e.g., wf_tpl_ig_organic_post">
        </div>
        <div class="form-group">
            <label>Task Prompt</label>
            <textarea id="taskPrompt" rows="3"
                placeholder="e.g., Create a post about AI trends">Create an Instagram post about the latest AI innovations in 2025</textarea>
        </div>
        <div class="form-group">
            <label>Channel ID (Optional)</label>
            <input type="text" id="channelId" value="ch_instagram_main" placeholder="e.g., ch_instagram_main">
        </div>
        <button id="runBtn" onclick="runTest()">‚ñ∂Ô∏è Run Workflow</button>
        <button onclick="clearLogs()" style="background: #555; margin-left: 10px;">üóëÔ∏è Clear Logs</button>
    </div>

    <div class="section">
        <h2>Execution Logs</h2>
        <div id="logs"></div>
    </div>

    <script>
        const logsDiv = document.getElementById('logs');

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(entry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(message);
        }

        function clearLogs() {
            logsDiv.innerHTML = '';
        }

        async function runTest() {
            const btn = document.getElementById('runBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Running...';

            try {
                log('=== Starting Workflow Execution ===', 'info');

                const projectId = document.getElementById('projectId').value;
                const teamInstanceId = document.getElementById('teamInstanceId').value;
                const workflowTemplateId = document.getElementById('workflowTemplateId').value;
                const taskPrompt = document.getElementById('taskPrompt').value;
                const channelId = document.getElementById('channelId').value;

                if (!projectId || !teamInstanceId || !workflowTemplateId) {
                    throw new Error('Please fill in all required fields');
                }

                log(`Project: ${projectId}`, 'info');
                log(`Team: ${teamInstanceId}`, 'info');
                log(`Workflow: ${workflowTemplateId}`, 'info');

                const result = await window.runWorkflow({
                    projectId,
                    teamInstanceId,
                    workflowTemplateId,
                    taskContext: {
                        prompt: taskPrompt,
                        channelId: channelId || null
                    }
                });

                log('=== Workflow Completed ===', 'success');
                log(`Status: ${result.status}`, result.status === 'completed' ? 'success' : 'warn');
                log(`Steps Executed: ${result.results.length}`, 'info');

                result.results.forEach((stepResult, index) => {
                    log(`  Step ${index + 1}: ${stepResult.stepId} - ${stepResult.status}`,
                        stepResult.status === 'completed' ? 'success' : 'error');
                });

                log('‚úÖ Test completed successfully!', 'success');

            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                console.error(error);
            } finally {
                btn.disabled = false;
                btn.textContent = '‚ñ∂Ô∏è Run Workflow';
            }
        }

        // Intercept console.log from orchestrator
        const originalLog = console.log;
        console.log = function (...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            if (message.includes('[Orchestrator]')) {
                const type = message.includes('failed') || message.includes('Error') ? 'error' :
                    message.includes('completed') || message.includes('‚úÖ') ? 'success' :
                        message.includes('warn') ? 'warn' : 'info';
                log(message, type);
            }
        };

        log('Workflow Orchestrator Test Page Loaded', 'success');
        log('Fill in the configuration and click "Run Workflow" to test', 'info');
    </script>
</body>

</html>