<div class="admin-actions-bar">
    <div class="admin-search-box">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input type="text" id="subagent-search" placeholder="Search templates...">
    </div>

    <!-- Scripts -->
    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>
    <script src="utils-runtime-profile.js"></script>


    <div class="admin-filters">
        <select id="filter-type" class="admin-select">
            <option value="all">All Types</option>
            <option value="planner">ğŸ¯ Planner</option>
            <option value="research">ğŸ” Research</option>
            <option value="creator_text">âœï¸ Creator.Text</option>
            <option value="creator_image">ğŸ¨ Creator.Image</option>
            <option value="creator_video">ğŸ¬ Creator.Video</option>
            <option value="engagement">ğŸ’¬ Engagement</option>
            <option value="compliance">âš–ï¸ Compliance</option>
            <option value="evaluator">ğŸ“Š Evaluator</option>
            <option value="manager">ğŸ‘” Manager</option>
            <option value="kpi">ğŸ“ˆ KPI</option>
            <option value="seo_watcher">ğŸ” SEO Watcher</option>
        </select>

        <select id="filter-status" class="admin-select">
            <option value="all">All Status</option>
            <option value="active">âœ… Active</option>
            <option value="draft">ğŸ“ Draft</option>
            <option value="deprecated">âŒ Deprecated</option>
        </select>

        <button class="admin-btn-primary" id="add-subagent-btn" onclick="window.createSubAgent()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Create Sub-Agent
        </button>
    </div>
</div>

<div class="admin-table-container">
    <table class="admin-table">
        <thead>
            <tr>
                <th>Type</th>
                <th>Template ID</th>
                <th>Version</th>
                <th>Status</th>
                <th>Default Profile</th>
                <th>Last Updated</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="subagents-table-body">
            <tr>
                <td colspan="7" style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                    Loading templates...
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- SubAgent Template Modal -->
<div id="subagent-modal" class="admin-modal" style="display: none;">
    <div class="admin-modal-content" style="max-width: 800px;">
        <div class="admin-modal-header">
            <h3 class="admin-modal-title" id="modal-title">Create Sub-Agent Template</h3>
            <button class="admin-modal-close" id="modal-close">&times;</button>
        </div>
        <div class="admin-modal-body">
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="overview">Overview</button>
                <button class="admin-tab" data-tab="global">Global Settings</button>
                <button class="admin-tab" data-tab="adapters">Channel Adapters</button>
            </div>

            <form id="subagent-form">
                <input type="hidden" id="subagent-id">

                <!-- Tab: Overview -->
                <div id="tab-overview" class="admin-tab-content active">
                    <div class="admin-form-group">
                        <label class="admin-form-label">Engine Type (Core Logic)</label>
                        <select id="subagent-type" class="admin-select" style="width: 100%;" required>
                            <option value="">Select Engine Type...</option>
                            <option value="planner">ğŸ¯ Planner - Strategic content planning</option>
                            <option value="research">ğŸ” Research - Market analysis</option>
                            <option value="creator_text">âœï¸ Creator.Text - Text generation</option>
                            <option value="creator_image">ğŸ¨ Creator.Image - Image generation</option>
                            <option value="creator_video">ğŸ¬ Creator.Video - Video generation</option>
                            <option value="engagement">ğŸ’¬ Engagement - Reply & Interaction</option>
                            <option value="compliance">âš–ï¸ Compliance - Fact checking & Safety</option>
                            <option value="evaluator">ğŸ“Š Evaluator - Quality assessment</option>
                            <option value="manager">ğŸ‘” Manager - Final approval</option>
                            <option value="kpi">ğŸ“ˆ KPI - Performance optimization</option>
                            <option value="seo_watcher">ğŸ” SEO Watcher - SEO policy monitoring</option>
                        </select>
                    </div>

                    <!-- v2.0 3-Axis Metadata -->
                    <div
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Role Type (v2.0)</label>
                            <select id="subagent-role" class="admin-select" style="width: 100%;" required>
                                <!-- Populated by JS -->
                            </select>
                        </div>
                        <div class="admin-form-group">
                            <label class="admin-form-label">Primary Language (v2.0)</label>
                            <select id="subagent-language" class="admin-select" style="width: 100%;" required>
                                <!-- Populated by JS -->
                            </select>
                        </div>
                    </div>

                    <!-- Version & Status in one row -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="admin-form-group" style="margin-bottom: 0;">
                            <label class="admin-form-label">Version</label>
                            <input type="text" id="subagent-version" class="admin-form-input" placeholder="1.0.0"
                                readonly style="opacity: 0.7; cursor: not-allowed;">
                        </div>
                        <div class="admin-form-group" style="margin-bottom: 0;">
                            <label class="admin-form-label">Status</label>
                            <select id="subagent-status" class="admin-select" style="width: 100%;" required>
                                <option value="active">âœ… Active</option>
                                <option value="draft">ğŸ“ Draft</option>
                                <option value="deprecated">âŒ Deprecated</option>
                            </select>
                        </div>
                    </div>

                    <div class="admin-form-group">
                        <label class="admin-form-label">System Prompt Template (Core)</label>
                        <textarea id="subagent-prompt" class="admin-form-input" rows="8" required
                            placeholder="You are a strategic content planner..."></textarea>
                    </div>
                </div>

                <!-- Tab: Global Settings -->
                <div id="tab-global" class="admin-tab-content">
                    <div class="admin-form-group"
                        style="background: rgba(22, 224, 189, 0.05); padding: 15px; border-radius: 8px; border: 1px solid rgba(22, 224, 189, 0.2);">
                        <label class="admin-form-label" style="color: #16e0bd;">ğŸš€ Default Runtime Profile</label>
                        <select id="subagent-profile" class="admin-select" style="width: 100%;">
                            <option value="">Select a Profile...</option>
                            <!-- Options will be loaded dynamically -->
                        </select>
                        <small style="color: rgba(255,255,255,0.6); display: block; margin-top: 5px;">
                            Select a default Runtime Profile for instances created from this template.
                        </small>
                    </div>

                    <div class="admin-form-group">
                        <label class="admin-form-label">Default LLM Model (Fallback)</label>
                        <select id="model-llm-text" class="admin-select" style="width: 100%;">
                            <option value="gpt-4">GPT-4 (OpenAI)</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo (OpenAI)</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (OpenAI)</option>
                            <option value="claude-3-opus">Claude 3 Opus (Anthropic)</option>
                            <option value="claude-3-sonnet">Claude 3 Sonnet (Anthropic)</option>
                            <option value="gemini-pro">Gemini Pro (Google)</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro (Google)</option>
                        </select>
                    </div>

                    <!-- Temp & Max Tokens in one row with Sliders -->
                    <div
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; background: rgba(255,255,255,0.03); padding: 16px; border-radius: 8px;">
                        <!-- Temperature -->
                        <div class="admin-form-group" style="margin-bottom: 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <label class="admin-form-label" style="margin-bottom: 0;">Temperature</label>
                                <span id="temp-display"
                                    style="font-size: 12px; color: #16e0bd; font-weight: bold;">0.7</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="config-temperature-slider" min="0" max="2" step="0.1"
                                    value="0.7" style="flex: 1; cursor: pointer;">
                                <input type="number" id="config-temperature" class="admin-form-input" min="0" max="2"
                                    step="0.1" value="0.7" style="width: 60px; padding: 4px 8px; text-align: center;">
                            </div>
                        </div>

                        <!-- Max Tokens -->
                        <div class="admin-form-group" style="margin-bottom: 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <label class="admin-form-label" style="margin-bottom: 0;">Max Tokens</label>
                                <span id="tokens-display"
                                    style="font-size: 12px; color: #16e0bd; font-weight: bold;">2000</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="config-max-tokens-slider" min="100" max="8000" step="100"
                                    value="2000" style="flex: 1; cursor: pointer;">
                                <input type="number" id="config-max-tokens" class="admin-form-input" min="100"
                                    max="8000" step="100" value="2000"
                                    style="width: 70px; padding: 4px 8px; text-align: center;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Channel Adapters -->
                <div id="tab-adapters" class="admin-tab-content">
                    <div class="admin-section-header" style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="margin: 0; color: #fff;">Channel Specific Behaviors</h4>
                        </div>
                        <p style="margin: 5px 0 0 0; font-size: 12px; color: rgba(255,255,255,0.5);">
                            Define specific prompt overrides for different channels (e.g., shorter replies for Twitter).
                        </p>
                    </div>

                    <!-- Add Adapter UI -->
                    <div
                        style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; margin-bottom: 16px; display: flex; gap: 10px; align-items: center;">
                        <select id="new-adapter-channel" class="admin-select" style="flex: 1;">
                            <option value="">Select Channel to Add...</option>
                            <option value="instagram">ğŸ“¸ Instagram</option>
                            <option value="twitter">ğŸ¦ Twitter (X)</option>
                            <option value="youtube">â–¶ï¸ YouTube</option>
                            <option value="linkedin">ğŸ’¼ LinkedIn</option>
                            <option value="discord">ğŸ’¬ Discord</option>
                            <option value="telegram">âœˆï¸ Telegram</option>
                            <option value="email">ğŸ“§ Email</option>
                        </select>
                        <button type="button" onclick="addAdapterFromUI()" class="admin-btn-primary"
                            style="padding: 8px 16px; font-size: 13px;">
                            + Add
                        </button>
                    </div>

                    <div id="adapters-list" style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- Adapters will be rendered here -->
                        <div
                            style="text-align: center; padding: 20px; color: rgba(255,255,255,0.3); border: 1px dashed rgba(255,255,255,0.1); border-radius: 8px;">
                            No channel adapters configured.
                        </div>
                    </div>
                </div>

            </form>
        </div>
        <div class="admin-modal-footer">
            <button class="admin-btn-secondary" id="modal-cancel">Cancel</button>
            <button class="admin-btn-primary" id="modal-save">Save Template</button>
        </div>
    </div>
</div>