<style>
    /* Page Tabs */
    .page-tabs {
        display: flex;
        gap: 20px;
        margin-bottom: 24px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 0;
    }

    .page-tab {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.6);
        padding: 12px 4px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        position: relative;
        transition: all 0.2s;
    }

    .page-tab:hover {
        color: #fff;
    }

    .page-tab.active {
        color: #16e0bd;
    }

    .page-tab.active::after {
        content: '';
        position: absolute;
        bottom: -1px;
        left: 0;
        width: 100%;
        height: 2px;
        background: #16e0bd;
        box-shadow: 0 -2px 8px rgba(22, 224, 189, 0.5);
    }

    /* Canvas View Styles */
    .canvas-header {
        margin-bottom: 24px;
    }

    .canvas-header h2 {
        font-size: 20px;
        font-weight: 600;
        color: #fff;
        margin: 0 0 8px 0;
    }

    .canvas-header p {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.5);
        margin: 0;
    }

    .engine-canvas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        padding-bottom: 40px;
    }

    .engine-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 20px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        backdrop-filter: blur(10px);
    }

    .engine-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 16px;
        box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.02);
        pointer-events: none;
    }

    .engine-card:hover {
        transform: translateY(-4px);
        border-color: rgba(22, 224, 189, 0.3);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2),
            0 0 16px rgba(22, 224, 189, 0.1);
    }

    /* Pulse Animation for Glow */
    @keyframes pulse-glow {
        0% {
            box-shadow: 0 0 0 0 rgba(22, 224, 189, 0);
        }

        50% {
            box-shadow: 0 0 12px 2px rgba(22, 224, 189, 0.15);
        }

        100% {
            box-shadow: 0 0 0 0 rgba(22, 224, 189, 0);
        }
    }

    .engine-card.pulse {
        animation: pulse-glow 3s infinite;
    }

    /* Float Animation for Icon */
    @keyframes float-icon {

        0%,
        100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-4px);
        }
    }

    .engine-icon-wrapper {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin-bottom: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: float-icon 4s ease-in-out infinite;
    }

    .engine-card:nth-child(even) .engine-icon-wrapper {
        animation-delay: 1s;
    }

    .engine-card:nth-child(3n) .engine-icon-wrapper {
        animation-delay: 2s;
    }

    .engine-title {
        font-size: 16px;
        font-weight: 600;
        color: #fff;
        margin-bottom: 4px;
    }

    .engine-desc {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 20px;
        line-height: 1.4;
        min-height: 34px;
        /* 2 lines */
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .engine-kpi-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 16px;
    }

    .kpi-item {
        display: flex;
        flex-direction: column;
    }

    .kpi-label {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.4);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 2px;
    }

    .kpi-value {
        font-size: 14px;
        font-weight: 600;
        color: #e2e8f0;
        font-family: 'JetBrains Mono', monospace;
    }

    /* Status Indicators */
    .status-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        position: absolute;
        top: 20px;
        right: 20px;
    }

    .status-active {
        background: #22c55e;
        box-shadow: 0 0 8px #22c55e;
    }

    .status-experimental {
        background: #8b5cf6;
        box-shadow: 0 0 8px #8b5cf6;
    }

    .status-deprecated {
        background: #ef4444;
        box-shadow: 0 0 8px #ef4444;
    }
</style>

<!-- Page Tabs -->
<div class="page-tabs">
    <button class="page-tab active" onclick="switchPageView('canvas')" id="tab-btn-canvas">Sub-Agent List</button>
    <button class="page-tab" onclick="switchPageView('templates')" id="tab-btn-templates">Sub-Agent Templates</button>
</div>

<!-- View 1: Canvas (Default) -->
<div id="view-canvas" class="page-view">
    <div class="canvas-header">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
                <h2>Sub-Agent List</h2>
                <p>A visual canvas of ZYNK's 12 Sub-Agent Engines. These are the living cores of your agent swarm.</p>
            </div>
            <!-- Optional: Simple filter for canvas -->
            <div style="display: flex; gap: 8px;">
                <span
                    style="font-size: 12px; color: rgba(255,255,255,0.4); padding: 4px 8px; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;">12
                    Engines Active</span>
            </div>
        </div>
    </div>
    <div class="engine-canvas-grid" id="engine-canvas-grid">
        <!-- Cards will be injected by JS -->
        <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: rgba(255,255,255,0.3);">
            Initializing Neural Canvas...
        </div>
    </div>
</div>

<!-- View 2: Templates (Existing) -->
<div id="view-templates" class="page-view" style="display: none;">
    <div class="admin-actions-bar">
        <div class="admin-search-box">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" id="subagent-search" placeholder="Search templates...">
        </div>

        <!-- Scripts -->
        <script src="firebase-config.js"></script>
        <script src="utils-runtime-resolver.js"></script>
        <script src="admin-subagents.js"></script>
        <script src="utils-runtime-profile.js"></script>


        <div class="admin-filters">
            <select id="filter-type" class="admin-select">
                <option value="all">All Types</option>
                <option value="planner">üéØ Planner</option>
                <option value="research">üîç Research</option>
                <option value="creator_text">‚úçÔ∏è Creator.Text</option>
                <option value="creator_image">üé® Creator.Image</option>
                <option value="creator_video">üé¨ Creator.Video</option>
                <option value="engagement">üí¨ Engagement</option>
                <option value="compliance">‚öñÔ∏è Compliance</option>
                <option value="evaluator">üìä Evaluator</option>
                <option value="manager">üëî Manager</option>
                <option value="kpi">üìà KPI</option>
                <option value="seo_watcher">üîé SEO Watcher</option>
                <option value="knowledge_curator">üìö Knowledge Curator</option>
            </select>

            <select id="filter-status" class="admin-select">
                <option value="all">All Status</option>
                <option value="active">‚úÖ Active</option>
                <option value="draft">üìù Draft</option>
                <option value="deprecated">‚ùå Deprecated</option>
            </select>

            <button class="admin-btn-primary" id="add-subagent-btn" onclick="window.createSubAgent()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Create Sub-Agent
            </button>
        </div>
    </div>

    <div class="admin-table-container">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Template ID</th>
                    <th>Version</th>
                    <th>Status</th>
                    <th>Default Profile</th>
                    <th>Last Updated</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="subagents-table-body">
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        Loading templates...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- SubAgent Template Modal -->
<div id="subagent-modal" class="admin-modal" style="display: none;">
    <div class="admin-modal-content" style="max-width: 800px;">
        <div class="admin-modal-header">
            <h3 class="admin-modal-title" id="modal-title">Create Sub-Agent Template</h3>
            <button class="admin-modal-close" id="modal-close">&times;</button>
        </div>
        <div class="admin-modal-body">
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="overview">Overview</button>
                <button class="admin-tab" data-tab="global">Global Settings</button>
                <button class="admin-tab" data-tab="adapters">Channel Adapters</button>
            </div>

            <form id="subagent-form">
                <input type="hidden" id="subagent-id">

                <!-- Tab: Overview -->
                <div id="tab-overview" class="admin-tab-content active">
                    <div class="admin-form-group">
                        <label class="admin-form-label">Engine Type (Core Logic)</label>
                        <select id="subagent-type" class="admin-select" style="width: 100%;" required>
                            <option value="">Select Engine Type...</option>
                            <option value="planner">üéØ Planner - Strategic content planning</option>
                            <option value="research">üîç Research - Market analysis</option>
                            <option value="creator_text">‚úçÔ∏è Creator.Text - Text generation</option>
                            <option value="creator_image">üé® Creator.Image - Image generation</option>
                            <option value="creator_video">üé¨ Creator.Video - Video generation</option>
                            <option value="engagement">üí¨ Engagement - Reply & Interaction</option>
                            <option value="compliance">‚öñÔ∏è Compliance - Fact checking & Safety</option>
                            <option value="evaluator">üìä Evaluator - Quality assessment</option>
                            <option value="manager">üëî Manager - Final approval</option>
                            <option value="kpi">üìà KPI - Performance optimization</option>
                            <option value="seo_watcher">üîé SEO Watcher - SEO policy monitoring</option>
                            <option value="knowledge_curator">üìö Knowledge Curator - Brand memory & knowledge management
                            </option>
                        </select>
                    </div>

                    <!-- Role Family (v2.0) -->
                    <div class="admin-form-group">
                        <label class="admin-form-label">Role Family</label>
                        <select id="subagent-family" class="admin-select" style="width: 100%;" required
                            onchange="autoFillSystemPrompt(this.value)">
                            <option value="">Select Role Family...</option>
                            <option value="strategy">Strategy (Planner, Manager)</option>
                            <option value="creation">Creation (Text, Image, Video)</option>
                            <option value="conversation">Conversation (Engagement)</option>
                            <option value="governance">Governance (Compliance, Evaluator, SEO)</option>
                            <option value="intelligence">Intelligence (KPI, Research)</option>
                            <option value="memory">Memory (Knowledge Curator)</option>
                        </select>
                    </div>

                    <!-- Brand Brain Configuration (v2.0) -->
                    <div
                        style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.1);">
                        <label class="admin-form-label" style="margin-bottom: 10px; color: #a78bfa;">üß† Brand Brain
                            Integration</label>
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="subagent-requires-brand-brain">
                                Requires Brand Brain
                            </label>

                            <div style="flex: 1;">
                                <select id="subagent-brand-context-mode" class="admin-select" style="width: 100%;">
                                    <option value="none">Mode: None</option>
                                    <option value="light">Mode: Light (Context Only)</option>
                                    <option value="full">Mode: Full (RAG + Learning)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- v2.0 Runtime Configuration (Preset-based) -->
                    <div
                        style="margin-bottom: 16px; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                        <label class="admin-form-label" style="margin-bottom: 12px; display: block;">
                            ‚öôÔ∏è Runtime Configuration Preset
                        </label>

                        <div id="runtime-presets" style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- Presets will be populated by JavaScript -->
                        </div>

                        <!-- Custom Configuration (hidden by default) -->
                        <div id="custom-runtime-config"
                            style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                                <div class="admin-form-group" style="margin-bottom: 0;">
                                    <label class="admin-form-label" style="font-size: 12px;">Role Type</label>
                                    <select id="subagent-role" class="admin-select" style="width: 100%;"></select>
                                </div>
                                <div class="admin-form-group" style="margin-bottom: 0;">
                                    <label class="admin-form-label" style="font-size: 12px;">Language</label>
                                    <select id="subagent-language" class="admin-select" style="width: 100%;"></select>
                                </div>
                                <div class="admin-form-group" style="margin-bottom: 0;">
                                    <label class="admin-form-label" style="font-size: 12px;">Tier</label>
                                    <select id="subagent-tier" class="admin-select" style="width: 100%;"></select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Version & Status in one row -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="admin-form-group" style="margin-bottom: 0;">
                            <label class="admin-form-label">Version</label>
                            <input type="text" id="subagent-version" class="admin-form-input" placeholder="1.0.0"
                                readonly style="opacity: 0.7; cursor: not-allowed;">
                        </div>
                        <div class="admin-form-group" style="margin-bottom: 0;">
                            <label class="admin-form-label">Status</label>
                            <select id="subagent-status" class="admin-select" style="width: 100%;" required>
                                <option value="active">‚úÖ Active</option>
                                <option value="draft">üìù Draft</option>
                                <option value="deprecated">‚ùå Deprecated</option>
                            </select>
                        </div>
                    </div>

                    <!-- System Prompt Template Selector (v3.0) -->
                    <div class="admin-form-group"
                        style="background: rgba(22, 224, 189, 0.05); padding: 15px; border-radius: 8px; border: 1px solid rgba(22, 224, 189, 0.2);">
                        <label class="admin-form-label" style="color: #16e0bd;">üìù System Prompt Source</label>
                        <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="prompt-source" value="template" checked
                                    onchange="togglePromptSource()">
                                <span>Use Template</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="prompt-source" value="custom" onchange="togglePromptSource()">
                                <span>Custom Prompt</span>
                            </label>
                        </div>
                        <div id="template-selector-container">
                            <select id="prompt-template-select" class="admin-select" onchange="loadPromptTemplate()">
                                <option value="">Select a template...</option>
                                <!-- Populated by JavaScript -->
                            </select>
                            <div id="template-preview"
                                style="margin-top: 8px; font-size: 12px; color: rgba(255,255,255,0.6);"></div>
                        </div>
                    </div>

                    <div class="admin-form-group">
                        <label class="admin-form-label">System Prompt Template (Core)</label>
                        <textarea id="subagent-prompt" class="admin-form-input" rows="8" required
                            placeholder="You are a strategic content planner..."></textarea>
                    </div>
                </div>

                <!-- Tab: Global Settings -->
                <div id="tab-global" class="admin-tab-content">
                    <div class="admin-form-group"
                        style="background: rgba(22, 224, 189, 0.05); padding: 15px; border-radius: 8px; border: 1px solid rgba(22, 224, 189, 0.2);">
                        <label class="admin-form-label" style="color: #16e0bd;">üöÄ Dynamic Runtime Resolution</label>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7); margin-top: 4px; line-height: 1.4;">
                            LLM configuration is now <strong>dynamically resolved</strong> at runtime based on:
                            <br>‚Ä¢ Engine Type (e.g., Planner)
                            <br>‚Ä¢ Role Type (e.g., Strategist)
                            <br>‚Ä¢ Language (e.g., Korean)
                            <br>‚Ä¢ Preferred Tier (e.g., Balanced)
                            <br><br>
                            This eliminates the need to manually select a Runtime Profile.
                        </p>
                    </div>

                    <div class="admin-form-group">
                        <label class="admin-form-label">Default LLM Model (Fallback)</label>
                        <select id="model-llm-text" class="admin-select" style="width: 100%;">
                            <option value="gpt-4">GPT-4 (OpenAI)</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo (OpenAI)</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (OpenAI)</option>
                            <option value="claude-3-opus">Claude 3 Opus (Anthropic)</option>
                            <option value="claude-3-sonnet">Claude 3 Sonnet (Anthropic)</option>
                            <option value="gemini-pro">Gemini Pro (Google)</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro (Google)</option>
                        </select>
                    </div>

                    <!-- Temp & Max Tokens in one row with Sliders -->
                    <div
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; background: rgba(255,255,255,0.03); padding: 16px; border-radius: 8px;">
                        <!-- Temperature -->
                        <div class="admin-form-group" style="margin-bottom: 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <label class="admin-form-label" style="margin-bottom: 0;">Temperature</label>
                                <span id="temp-display"
                                    style="font-size: 12px; color: #16e0bd; font-weight: bold;">0.7</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="config-temperature-slider" min="0" max="2" step="0.1"
                                    value="0.7" style="flex: 1; cursor: pointer;">
                                <input type="number" id="config-temperature" class="admin-form-input" min="0" max="2"
                                    step="0.1" value="0.7" style="width: 60px; padding: 4px 8px; text-align: center;">
                            </div>
                        </div>

                        <!-- Max Tokens -->
                        <div class="admin-form-group" style="margin-bottom: 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <label class="admin-form-label" style="margin-bottom: 0;">Max Tokens</label>
                                <span id="tokens-display"
                                    style="font-size: 12px; color: #16e0bd; font-weight: bold;">2000</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="config-max-tokens-slider" min="100" max="8000" step="100"
                                    value="2000" style="flex: 1; cursor: pointer;">
                                <input type="number" id="config-max-tokens" class="admin-form-input" min="100"
                                    max="8000" step="100" value="2000"
                                    style="width: 70px; padding: 4px 8px; text-align: center;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Channel Adapters -->
                <div id="tab-adapters" class="admin-tab-content">
                    <div class="admin-section-header" style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="margin: 0; color: #fff;">Channel Specific Behaviors</h4>
                        </div>
                        <p style="margin: 5px 0 0 0; font-size: 12px; color: rgba(255,255,255,0.5);">
                            Define specific prompt overrides for different channels (e.g., shorter replies for Twitter).
                        </p>
                    </div>

                    <!-- Add Adapter UI -->
                    <div
                        style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; margin-bottom: 16px; display: flex; gap: 10px; align-items: center;">
                        <select id="new-adapter-channel" class="admin-select" style="flex: 1;">
                            <option value="">Select Channel to Add...</option>
                            <option value="instagram">üì∏ Instagram</option>
                            <option value="twitter">üê¶ Twitter (X)</option>
                            <option value="youtube">‚ñ∂Ô∏è YouTube</option>
                            <option value="linkedin">üíº LinkedIn</option>
                            <option value="discord">üí¨ Discord</option>
                            <option value="telegram">‚úàÔ∏è Telegram</option>
                            <option value="email">üìß Email</option>
                        </select>
                        <button type="button" onclick="addAdapterFromUI()" class="admin-btn-primary"
                            style="padding: 8px 16px; font-size: 13px;">
                            + Add
                        </button>
                    </div>

                    <div id="adapters-list" style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- Adapters will be rendered here -->
                        <div
                            style="text-align: center; padding: 20px; color: rgba(255,255,255,0.3); border: 1px dashed rgba(255,255,255,0.1); border-radius: 8px;">
                            No channel adapters configured.
                        </div>
                    </div>
                </div>

            </form>
        </div>
        <div class="admin-modal-footer">
            <button class="admin-btn-secondary" id="modal-cancel">Cancel</button>
            <button class="admin-btn-primary" id="modal-save">Save Template</button>
        </div>
    </div>
</div>