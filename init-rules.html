<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Initialize Runtime Profile Rules</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <style>
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: sans-serif;
            padding: 20px;
        }

        .log {
            font-family: monospace;
            white-space: pre-wrap;
        }

        .success {
            color: #4ade80;
        }

        .error {
            color: #f87171;
        }
    </style>
</head>

<body>
    <h1>Initializing Runtime Profile Rules...</h1>
    <div id="log" class="log"></div>

    <script>
        const logDiv = document.getElementById('log');
        function log(msg, type = 'info') {
            const el = document.createElement('div');
            el.textContent = msg;
            if (type === 'success') el.className = 'success';
            if (type === 'error') el.className = 'error';
            logDiv.appendChild(el);
            console.log(msg);
        }

        // 12 Engine Types with their default configurations
        const ENGINE_RULES = [
            {
                id: 'rule_planner_v1',
                engine_type: 'planner',
                name: 'Planner Default Rule',
                description: 'Strategic content planning and scheduling',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4-turbo', temperature: 0.9, max_tokens: 3000 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.7, max_tokens: 2000 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.3, max_tokens: 2000 }
                },
                language_overrides: {
                    'ja': { balanced: { provider: 'anthropic', model_id: 'claude-3-sonnet-20240229' } }
                }
            },
            {
                id: 'rule_research_v1',
                engine_type: 'research',
                name: 'Research Default Rule',
                description: 'Market analysis and trend research',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4-turbo', temperature: 0.8, max_tokens: 4000 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.6, max_tokens: 3000 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.2, max_tokens: 3000 }
                }
            },
            {
                id: 'rule_creator_text_v1',
                engine_type: 'creator_text',
                name: 'Text Creator Default Rule',
                description: 'Text content generation',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4-turbo', temperature: 1.0, max_tokens: 2000 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.8, max_tokens: 1500 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.5, max_tokens: 1500 }
                }
            },
            {
                id: 'rule_creator_image_v1',
                engine_type: 'creator_image',
                name: 'Image Creator Default Rule',
                description: 'Image generation and design',
                models: {
                    creative: { provider: 'openai', model_id: 'dall-e-3', temperature: 0.9, max_tokens: 1000 },
                    balanced: { provider: 'openai', model_id: 'dall-e-3', temperature: 0.7, max_tokens: 1000 },
                    precise: { provider: 'openai', model_id: 'dall-e-3', temperature: 0.5, max_tokens: 1000 }
                }
            },
            {
                id: 'rule_creator_video_v1',
                engine_type: 'creator_video',
                name: 'Video Creator Default Rule',
                description: 'Video script and storyboard generation',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4-turbo', temperature: 0.9, max_tokens: 3000 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.7, max_tokens: 2500 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.5, max_tokens: 2500 }
                }
            },
            {
                id: 'rule_engagement_v1',
                engine_type: 'engagement',
                name: 'Engagement Default Rule',
                description: 'Comment and interaction management',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4-turbo', temperature: 0.8, max_tokens: 500 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.7, max_tokens: 300 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.5, max_tokens: 300 }
                }
            },
            {
                id: 'rule_compliance_v1',
                engine_type: 'compliance',
                name: 'Compliance Default Rule',
                description: 'Fact checking and safety verification',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4', temperature: 0.3, max_tokens: 2000 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.2, max_tokens: 2000 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.1, max_tokens: 2000 }
                }
            },
            {
                id: 'rule_evaluator_v1',
                engine_type: 'evaluator',
                name: 'Evaluator Default Rule',
                description: 'Quality assessment and scoring',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4', temperature: 0.5, max_tokens: 2000 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.3, max_tokens: 1500 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.1, max_tokens: 1500 }
                }
            },
            {
                id: 'rule_manager_v1',
                engine_type: 'manager',
                name: 'Manager Default Rule',
                description: 'Final approval and decision making',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4', temperature: 0.6, max_tokens: 1500 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.4, max_tokens: 1000 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.2, max_tokens: 1000 }
                }
            },
            {
                id: 'rule_kpi_v1',
                engine_type: 'kpi',
                name: 'KPI Default Rule',
                description: 'Performance optimization and analytics',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4', temperature: 0.5, max_tokens: 2500 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.3, max_tokens: 2000 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.1, max_tokens: 2000 }
                }
            },
            {
                id: 'rule_seo_watcher_v1',
                engine_type: 'seo_watcher',
                name: 'SEO Watcher Default Rule',
                description: 'SEO policy monitoring and optimization',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4', temperature: 0.4, max_tokens: 2000 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.3, max_tokens: 1500 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.2, max_tokens: 1500 }
                }
            },
            {
                id: 'rule_knowledge_curator_v1',
                engine_type: 'knowledge_curator',
                name: 'Knowledge Curator Default Rule',
                description: 'Brand memory and knowledge management',
                models: {
                    creative: { provider: 'openai', model_id: 'gpt-4-turbo', temperature: 0.6, max_tokens: 4000 },
                    balanced: { provider: 'openai', model_id: 'gpt-4', temperature: 0.5, max_tokens: 3000 },
                    precise: { provider: 'openai', model_id: 'gpt-4', temperature: 0.3, max_tokens: 3000 }
                },
                language_overrides: {
                    'zh': { balanced: { provider: 'openai', model_id: 'gpt-4-turbo' } }
                }
            }
        ];

        async function init() {
            try {
                log('Starting initialization...');
                const db = firebase.firestore();
                const batch = db.batch();
                let count = 0;

                for (const rule of ENGINE_RULES) {
                    const ruleData = {
                        ...rule,
                        status: 'active',
                        version: '1.0.0',
                        created_at: firebase.firestore.FieldValue.serverTimestamp(),
                        updated_at: firebase.firestore.FieldValue.serverTimestamp(),
                        created_by: 'system'
                    };

                    const docRef = db.collection('runtimeProfileRules').doc(rule.id);
                    batch.set(docRef, ruleData);
                    count++;
                    log(`Prepared: ${rule.engine_type} -> ${rule.id}`);
                }

                await batch.commit();
                log(`Successfully created ${count} rules!`, 'success');

                // Signal completion for automation tools
                const done = document.createElement('div');
                done.id = 'init-done';
                document.body.appendChild(done);

            } catch (e) {
                log(`Error: ${e.message}`, 'error');
                console.error(e);
            }
        }

        // Wait for Firebase to initialize
        setTimeout(init, 1000);
    </script>
</body>

</html>