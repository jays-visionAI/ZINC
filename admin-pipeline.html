<style>
    .pipeline-global-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 16px 24px;
        margin-bottom: 24px;
        backdrop-filter: blur(12px);
    }

    .pipeline-info h2 {
        font-size: 1.25rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 4px;
    }

    .pipeline-info p {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.5);
    }

    .pipeline-project-selector {
        display: flex;
        align-items: center;
        gap: 12px;
        background: rgba(0, 0, 0, 0.2);
        padding: 8px 16px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .pipeline-project-selector label {
        font-size: 0.75rem;
        font-weight: 700;
        color: var(--color-cyan);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        white-space: nowrap;
    }

    #pipeline-project-select {
        min-width: 240px;
        background: transparent;
        border: none;
        color: #fff;
        font-size: 0.9rem;
        font-weight: 600;
        outline: none;
        cursor: pointer;
    }

    #pipeline-project-select option {
        background: #13131a;
        color: #fff;
    }

    .active-project-badge {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 4px 12px;
        background: rgba(22, 224, 189, 0.1);
        border: 1px solid rgba(22, 224, 189, 0.2);
        border-radius: 20px;
        margin-left: 12px;
    }

    .pulse-dot {
        width: 8px;
        height: 8px;
        background: #16e0bd;
        border-radius: 50%;
        box-shadow: 0 0 10px rgba(22, 224, 189, 0.5);
        animation: pipeline-pulse 2s infinite;
    }

    @keyframes pipeline-pulse {
        0% {
            transform: scale(1);
            opacity: 1;
        }

        50% {
            transform: scale(1.2);
            opacity: 0.7;
        }

        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    #active-project-name {
        font-size: 0.8rem;
        font-weight: 600;
        color: #16e0bd;
    }
</style>

<div class="admin-chatbot-container">
    <!-- Global Project Context Header -->
    <div class="pipeline-global-header">
        <div class="pipeline-info">
            <h2>5-Step Pipeline Management</h2>
            <p>Select a project to apply context across all pipeline stages</p>
        </div>
        <div class="pipeline-project-selector">
            <label>Testing Context:</label>
            <select id="pipeline-project-select" onchange="window.updatePipelineGlobalProject(this.value)">
                <option value="">Loading Projects...</option>
            </select>
            <div id="pipeline-project-active-badge" class="active-project-badge" style="display:none">
                <div class="pulse-dot"></div>
                <span id="active-project-name">No Project</span>
            </div>
        </div>
    </div>

    <div class="admin-tabs">
        <button class="admin-tab-btn" data-tab="market">1. Market Pulse</button>
        <button class="admin-tab-btn" data-tab="brand">2. Brand Brain</button>
        <button class="admin-tab-btn" data-tab="knowledge">3. Knowledge Hub</button>
        <button class="admin-tab-btn" data-tab="studio">4. Studio</button>
        <button class="admin-tab-btn" data-tab="growth">5. Growth</button>
    </div>

    <!-- 1. Market Pulse Tab -->
    <div id="tab-market" class="admin-tab-content">
        <div class="admin-card">
            <!-- Workflow Builder Button -->
            <div class="workflow-builder-trigger">
                <button class="workflow-btn" onclick="openWorkflowCanvas('market')">
                    <span class="workflow-btn-icon">ğŸš€</span>
                    <span class="workflow-btn-text">Workflow ìƒì„±í•˜ê¸°</span>
                    <span class="workflow-btn-badge">AI</span>
                </button>
                <p class="workflow-btn-desc">ìì—°ì–´ë¡œ ì—ì´ì „íŠ¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì„¤ê³„í•˜ê³  ìë™ ì½”ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”</p>
            </div>

            <!-- Workflow Cards List -->
            <div class="workflow-list-section" id="workflow-list-market">
                <div class="workflow-list-header">
                    <h4>ğŸ“‚ ì €ì¥ëœ ì›Œí¬í”Œë¡œìš° <span class="workflow-count" id="workflow-count-market">(0)</span></h4>
                    <button class="workflow-view-all-btn" onclick="viewAllWorkflows('market')">ì „ì²´ë³´ê¸° â†’</button>
                </div>
                <div class="workflow-cards-container" id="workflow-cards-market">
                    <!-- Cards will be rendered by JS -->
                    <div class="workflow-empty-state">
                        <span class="workflow-empty-icon">ğŸ“­</span>
                        <p>ì €ì¥ëœ ì›Œí¬í”Œë¡œìš°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <span class="workflow-empty-hint">ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒˆ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•˜ì„¸ìš”</span>
                    </div>
                </div>
            </div>

            <div class="admin-card-header">
                <h3>1. Market Pulse: Trend & Research Agents</h3>
                <p>Configure agents for real-time market sentiment, trend analysis, and SEO research.</p>
            </div>
            <div class="admin-section-divider"></div>
            <!-- Agent: Trend Researcher -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent: Trend Researcher (research)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Default Model</label>
                        <select id="agent-research-model" class="admin-input">
                            <option value="gpt-4o">GPT-4o (High Quality)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (Fast)</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                            <option value="deepseek-reasoner">DeepSeek R1 (Reasoning)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-research-temp" min="0" max="1" step="0.1" value="0.7">
                        <span id="label-research-temp">0.7</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>System Prompt</label>
                    <textarea id="agent-research-prompt" class="admin-input prompt-textarea"
                        placeholder="You are a Trend Researcher..."></textarea>
                </div>
            </div>
            <div class="admin-section-divider mt-8 mb-8"></div>
            <!-- Agent: SEO Watcher -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent: SEO Watcher (seo_watcher)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Default Model</label>
                        <select id="agent-seo-model" class="admin-input">
                            <option value="gpt-4o">GPT-4o (High Quality)</option>
                            <option value="gpt-4o-mini" selected>GPT-4o Mini (Fast)</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                            <option value="deepseek-reasoner">DeepSeek R1 (Reasoning)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-seo-temp" min="0" max="1" step="0.1" value="0.3">
                        <span id="label-seo-temp">0.3</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>System Prompt</label>
                    <textarea id="agent-seo-prompt" class="admin-input prompt-textarea"
                        placeholder="You are an SEO Specialist..."></textarea>
                </div>
            </div>
            <div class="admin-actions mt-8">
                <button id="save-market-settings" class="admin-btn-primary">Save Market Settings</button>
            </div>
        </div>
    </div>

    <!-- 2. Brand Brain Tab -->
    <div id="tab-brand" class="admin-tab-content">
        <div class="admin-card">
            <!-- Workflow Builder Button -->
            <div class="workflow-builder-trigger">
                <button class="workflow-btn" onclick="openWorkflowCanvas('brand')">
                    <span class="workflow-btn-icon">ğŸš€</span>
                    <span class="workflow-btn-text">Workflow ìƒì„±í•˜ê¸°</span>
                    <span class="workflow-btn-badge">AI</span>
                </button>
                <p class="workflow-btn-desc">ìì—°ì–´ë¡œ ì—ì´ì „íŠ¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì„¤ê³„í•˜ê³  ìë™ ì½”ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”</p>
            </div>

            <!-- Workflow Cards List -->
            <div class="workflow-list-section" id="workflow-list-brand">
                <div class="workflow-list-header">
                    <h4>ğŸ“‚ ì €ì¥ëœ ì›Œí¬í”Œë¡œìš° <span class="workflow-count" id="workflow-count-brand">(0)</span></h4>
                    <button class="workflow-view-all-btn" onclick="viewAllWorkflows('brand')">ì „ì²´ë³´ê¸° â†’</button>
                </div>
                <div class="workflow-cards-container" id="workflow-cards-brand">
                    <div class="workflow-empty-state">
                        <span class="workflow-empty-icon">ğŸ“­</span>
                        <p>ì €ì¥ëœ ì›Œí¬í”Œë¡œìš°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <span class="workflow-empty-hint">ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒˆ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•˜ì„¸ìš”</span>
                    </div>
                </div>
            </div>

            <div class="admin-card-header">
                <h3>2. Brand Brain: Strategic Planning Agent</h3>
                <p>Configure the lead agent responsible for project mission, vision, and core strategy.</p>
            </div>
            <div class="admin-section-divider"></div>
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent: Strategic Planner (planner)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Default Model</label>
                        <select id="agent-planner-model" class="admin-input">
                            <option value="gpt-4o" selected>GPT-4o (High Quality)</option>
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                            <option value="deepseek-reasoner">DeepSeek R1 (Reasoning)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-planner-temp" min="0" max="1" step="0.1" value="0.5">
                        <span id="label-planner-temp">0.5</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>System Prompt (Strategy Core)</label>
                    <textarea id="agent-planner-prompt" class="admin-input prompt-textarea"
                        placeholder="You are a Senior Brand Strategist..."></textarea>
                </div>
            </div>
            <div class="admin-actions mt-8">
                <button id="save-brand-settings" class="admin-btn-primary">Save Brand Brain Settings</button>
            </div>
        </div>
    </div>

    <!-- 3. Knowledge Hub Tab -->
    <div id="tab-knowledge" class="admin-tab-content">
        <div class="admin-card">
            <!-- Workflow Builder Button -->
            <div class="workflow-builder-trigger">
                <button class="workflow-btn" onclick="openWorkflowCanvas('knowledge')">
                    <span class="workflow-btn-icon">ğŸš€</span>
                    <span class="workflow-btn-text">Workflow ìƒì„±í•˜ê¸°</span>
                    <span class="workflow-btn-badge">AI</span>
                </button>
                <p class="workflow-btn-desc">ìì—°ì–´ë¡œ ì—ì´ì „íŠ¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì„¤ê³„í•˜ê³  ìë™ ì½”ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”</p>
            </div>

            <!-- Workflow Cards List -->
            <div class="workflow-list-section" id="workflow-list-knowledge">
                <div class="workflow-list-header">
                    <h4>ğŸ“‚ ì €ì¥ëœ ì›Œí¬í”Œë¡œìš° <span class="workflow-count" id="workflow-count-knowledge">(0)</span></h4>
                    <button class="workflow-view-all-btn" onclick="viewAllWorkflows('knowledge')">ì „ì²´ë³´ê¸° â†’</button>
                </div>
                <div class="workflow-cards-container" id="workflow-cards-knowledge">
                    <div class="workflow-empty-state">
                        <span class="workflow-empty-icon">ğŸ“­</span>
                        <p>ì €ì¥ëœ ì›Œí¬í”Œë¡œìš°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <span class="workflow-empty-hint">ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒˆ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•˜ì„¸ìš”</span>
                    </div>
                </div>
            </div>

            <div class="admin-card-header">
                <h3>3. Knowledge Hub: Brand Intelligence Agents</h3>
                <p>Configure specialized agents for document analysis and deep reporting.</p>
            </div>
            <div class="admin-section-divider"></div>
            <!-- Agent A: Brand Summary (Standard) -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent A: Brand Summary (Standard)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Default Model</label>
                        <select id="agent-standard-model" class="admin-input">
                            <option value="gpt-4o">GPT-4o (High Quality)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (Fast)</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                            <option value="deepseek-reasoner">DeepSeek R1 (Reasoning)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-standard-temp" min="0" max="1" step="0.1" value="0.2">
                        <span id="label-standard-temp">0.2</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>System Prompt</label>
                    <textarea id="agent-standard-prompt" class="admin-input prompt-textarea"
                        placeholder="Standard summary instructions..."></textarea>
                </div>
            </div>
            <div class="admin-section-divider mt-8 mb-8"></div>
            <!-- Agent B: Depth Report (A4 Analysis) -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent B: Depth Report (A4 Analysis)</h4>
                    <span class="status-badge info">Detailed Mode</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>High Performance Model</label>
                        <select id="agent-depth-model" class="admin-input">
                            <option value="gpt-4o">GPT-4o (High Quality)</option>
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="o1-preview">OpenAI o1-preview</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                            <option value="deepseek-reasoner">DeepSeek R1 (Reasoning)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-depth-temp" min="0" max="1" step="0.1" value="0.3">
                        <span id="label-depth-temp">0.3</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Depth Analysis Prompt</label>
                    <textarea id="agent-depth-prompt" class="admin-input prompt-textarea"
                        placeholder="Deep A4 reporting instructions..."></textarea>
                </div>
            </div>

            <!-- NEW: Contents Generation Agents -->
            <div class="admin-section-divider mt-12 mb-8"></div>
            <h3 class="mb-6" style="color: var(--color-cyan); font-size: 1.1rem;">Contents Generation Pipeline</h3>

            <!-- Agent C: Insight Analyst -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent C: Insight Analyst (Mind Map, Competitor Analysis, Persona)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Reasoning Model</label>
                        <select id="agent-insights-model" class="admin-input">
                            <option value="deepseek-reasoner">DeepSeek R1 (Reasoning)</option>
                            <option value="o1-preview">OpenAI o1-preview</option>
                            <option value="gpt-4o">GPT-4o (High Quality)</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-insights-temp" min="0" max="1" step="0.1" value="0.3">
                        <span id="label-insights-temp">0.3</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Insights Analysis Prompt</label>
                    <textarea id="agent-insights-prompt" class="admin-input prompt-textarea tiny"
                        placeholder="Focus on pattern recognition and competitive advantage..."></textarea>
                </div>
            </div>

            <div class="admin-section-divider mt-8 mb-8"></div>

            <!-- Agent D: Strategic Planner -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent D: Strategic Planner (Campaign Brief, Content Calendar, Strategy)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Planning Model</label>
                        <select id="agent-strategy-model" class="admin-input">
                            <option value="gpt-4o">GPT-4o (High Quality)</option>
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                            <option value="deepseek-reasoner">DeepSeek R1 (Reasoning)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (Fast)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-strategy-temp" min="0" max="1" step="0.1" value="0.6">
                        <span id="label-strategy-temp">0.6</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Strategy Planning Prompt</label>
                    <textarea id="agent-strategy-prompt" class="admin-input prompt-textarea tiny"
                        placeholder="Focus on goal setting and channel optimization..."></textarea>
                </div>
            </div>

            <div class="admin-section-divider mt-8 mb-8"></div>

            <!-- Agent E: Creative Copywriter -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent E: Creative Copywriter (Social Ideas, Ad Copy, Trends)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Creative Model</label>
                        <select id="agent-quick-model" class="admin-input">
                            <option value="gpt-4o-mini">GPT-4o Mini (Fast/Creative)</option>
                            <option value="gpt-4o">GPT-4o (High Quality)</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                            <option value="deepseek-reasoner">DeepSeek R1 (Reasoning)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-quick-temp" min="0" max="1" step="0.1" value="0.9">
                        <span id="label-quick-temp">0.9</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Creative Copy Prompt</label>
                    <textarea id="agent-quick-prompt" class="admin-input prompt-textarea tiny"
                        placeholder="Focus on trendy, engaging, and generation-specific copy..."></textarea>
                </div>
            </div>

            <div class="admin-section-divider mt-8 mb-8"></div>

            <!-- Agent F: Document Designer -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent F: Document Designer (Press Release, Email, Professional Drafts)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Precision Model</label>
                        <select id="agent-studio-docs-model" class="admin-input">
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="gpt-4o">GPT-4o (High Quality)</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                            <option value="deepseek-reasoner">DeepSeek R1 (Reasoning)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-studio-docs-temp" min="0" max="1" step="0.1" value="0.4">
                        <span id="label-studio-docs-temp">0.4</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Document Layout & Tone Prompt</label>
                    <textarea id="agent-studio-docs-prompt" class="admin-input prompt-textarea tiny"
                        placeholder="Focus on professional document structure and formal tone..."></textarea>
                </div>
            </div>

            <div class="admin-section-divider mt-8 mb-8"></div>

            <!-- Agent G: Visual Director -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent G: Visual Director (Promo Images, Brochure, 1-Pager, Pitch Deck)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Visual Prompting Model</label>
                        <select id="agent-studio-visual-model" class="admin-input">
                            <option value="gpt-4o-mini">GPT-4o Mini (Efficient Prompting)</option>
                            <option value="gpt-4o">GPT-4o (High Logic)</option>
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                            <option value="deepseek-reasoner">DeepSeek R1 (Reasoning)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-studio-visual-temp" min="0" max="1" step="0.1" value="0.7">
                        <span id="label-studio-visual-temp">0.7</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Image Prompt Engineering Guide</label>
                    <textarea id="agent-studio-visual-prompt" class="admin-input prompt-textarea tiny"
                        placeholder="Focus on generating high-fidelity AI image prompts..."></textarea>
                </div>
            </div>
            <div class="admin-actions mt-8">
                <button id="save-knowledge-settings" class="admin-btn-primary">Save Knowledge Hub Settings</button>
            </div>
        </div>
    </div>

    <!-- 4. Studio Tab -->
    <div id="tab-studio" class="admin-tab-content">
        <div class="admin-card">
            <!-- Workflow Builder Button -->
            <div class="workflow-builder-trigger">
                <button class="workflow-btn" onclick="openWorkflowCanvas('studio')">
                    <span class="workflow-btn-icon">ğŸš€</span>
                    <span class="workflow-btn-text">Workflow ìƒì„±í•˜ê¸°</span>
                    <span class="workflow-btn-badge">AI</span>
                </button>
                <p class="workflow-btn-desc">ìì—°ì–´ë¡œ ì—ì´ì „íŠ¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì„¤ê³„í•˜ê³  ìë™ ì½”ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”</p>
            </div>

            <!-- Workflow Cards List -->
            <div class="workflow-list-section" id="workflow-list-studio">
                <div class="workflow-list-header">
                    <h4>ğŸ“‚ ì €ì¥ëœ ì›Œí¬í”Œë¡œìš° <span class="workflow-count" id="workflow-count-studio">(0)</span></h4>
                    <button class="workflow-view-all-btn" onclick="viewAllWorkflows('studio')">ì „ì²´ë³´ê¸° â†’</button>
                </div>

                <!-- Business Category Filter -->
                <div class="workflow-category-filter" data-context="studio">
                    <button class="filter-chip active" data-category="ëª¨ë‘">ğŸ  ëª¨ë‘</button>
                    <button class="filter-chip" data-category="SNS/ë§ˆì¼€íŒ…">ğŸ“± SNS/ë§ˆì¼€íŒ…</button>
                    <button class="filter-chip" data-category="ë¸”ë¡œê·¸/í•™ìŠµ">âœï¸ ë¸”ë¡œê·¸/í•™ìŠµ</button>
                    <button class="filter-chip" data-category="ì˜ì—…/ë‰´ìŠ¤ë ˆí„°">ğŸ“§ ì˜ì—…/ë‰´ìŠ¤ë ˆí„°</button>
                    <button class="filter-chip" data-category="ì „ëµ/ê¸°íš">ğŸ’¡ ì „ëµ/ê¸°íš</button>
                </div>

                <div class="workflow-cards-container" id="workflow-cards-studio">
                    <div class="workflow-empty-state">
                        <span class="workflow-empty-icon">ğŸ“­</span>
                        <p>ì €ì¥ëœ ì›Œí¬í”Œë¡œìš°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <span class="workflow-empty-hint">ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒˆ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•˜ì„¸ìš”</span>
                    </div>
                </div>
            </div>

            <div class="admin-card-header">
                <h3>4. Studio: Final Content Production</h3>
                <p>Configure the orchestrator and production agents for final visual and text output.</p>
            </div>
            <div class="admin-section-divider"></div>

            <!-- Agent: Visual Creator (creator) -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent: Visual Creator (creator)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Production Model</label>
                        <select id="agent-creator-model" class="admin-input">
                            <option value="gpt-4o" selected>GPT-4o (High Quality)</option>
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-creator-temp" min="0" max="1" step="0.1" value="0.7">
                        <span id="label-creator-temp">0.7</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Creative Direction Prompt</label>
                    <textarea id="agent-creator-prompt" class="admin-input prompt-textarea tiny"
                        placeholder="Focus on visual composition and rendering instructions..."></textarea>
                </div>
            </div>

            <div class="admin-section-divider mt-8 mb-8"></div>

            <!-- Agent: Text Producer (text) -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4>Agent: Text Producer (text)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Copywriting Model</label>
                        <select id="agent-text-model" class="admin-input">
                            <option value="gpt-4o" selected>GPT-4o (High Quality)</option>
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-text-temp" min="0" max="1" step="0.1" value="0.8">
                        <span id="label-text-temp">0.8</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Text Finalization Prompt</label>
                    <textarea id="agent-text-prompt" class="admin-input prompt-textarea tiny"
                        placeholder="Focus on tone, grammar, and platform-specific formatting..."></textarea>
                </div>
            </div>

            <div class="admin-section-divider mt-8 mb-8"></div>

            <!-- Agent: Studio Orchestrator (orchestrator) -->
            <div class="agent-setting-group">
                <div class="flex-between mb-4">
                    <h4 style="color: var(--color-cyan);">Studio Orchestrator (orchestrator)</h4>
                    <span class="status-badge success">Master Controller</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Orchestration Model (Reasoning)</label>
                        <select id="agent-orchestrator-model" class="admin-input">
                            <option value="gpt-4o">GPT-4o (High Quality)</option>
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="deepseek-reasoner">DeepSeek R1 (Deep Reasoning)</option>
                            <option value="o1-preview">OpenAI o1-preview</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Orchestration Temp</label>
                        <input type="range" id="agent-orchestrator-temp" min="0" max="1" step="0.1" value="0.5">
                        <span id="label-orchestrator-temp">0.5</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Behavioral Basis & Persona (Master Prompt)</label>
                    <textarea id="agent-orchestrator-prompt" class="admin-input prompt-textarea tiny"
                        placeholder="You are the Studio Orchestrator. Your goal is to analyze user goals and coordinate the agent team..."></textarea>
                </div>
                <div class="form-group mt-4 flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="orchestrator-complexity-routing" checked>
                        <label for="orchestrator-complexity-routing" style="font-size: 13px; color: #aaa;">Enable 5-Tier
                            Complexity Routing</label>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="orchestrator-brand-sync" checked>
                        <label for="orchestrator-brand-sync" style="font-size: 13px; color: #aaa;">Auto-Sync Brand
                            Context
                            (Layer 3)</label>
                    </div>
                </div>
            </div>

            <div class="admin-actions mt-8">
                <button id="save-studio-settings" class="admin-btn-primary">Save Studio Settings</button>
            </div>
        </div>
    </div>

    <!-- 5. Growth Tab -->
    <div id="tab-growth" class="admin-tab-content">
        <div class="admin-card">
            <!-- Workflow Builder Button -->
            <div class="workflow-builder-trigger">
                <button class="workflow-btn" onclick="openWorkflowCanvas('growth')">
                    <span class="workflow-btn-icon">ğŸš€</span>
                    <span class="workflow-btn-text">Workflow ìƒì„±í•˜ê¸°</span>
                    <span class="workflow-btn-badge">AI</span>
                </button>
                <p class="workflow-btn-desc">ìì—°ì–´ë¡œ ì—ì´ì „íŠ¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì„¤ê³„í•˜ê³  ìë™ ì½”ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”</p>
            </div>

            <!-- Workflow Cards List -->
            <div class="workflow-list-section" id="workflow-list-growth">
                <div class="workflow-list-header">
                    <h4>ğŸ“‚ ì €ì¥ëœ ì›Œí¬í”Œë¡œìš° <span class="workflow-count" id="workflow-count-growth">(0)</span></h4>
                    <button class="workflow-view-all-btn" onclick="viewAllWorkflows('growth')">ì „ì²´ë³´ê¸° â†’</button>
                </div>
                <div class="workflow-cards-container" id="workflow-cards-growth">
                    <div class="workflow-empty-state">
                        <span class="workflow-empty-icon">ğŸ“­</span>
                        <p>ì €ì¥ëœ ì›Œí¬í”Œë¡œìš°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <span class="workflow-empty-hint">ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒˆ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•˜ì„¸ìš”</span>
                    </div>
                </div>
            </div>

            <div class="admin-card-header">
                <h3>5. The Growth: Optimization & Analytics Agents</h3>
                <p>Configure agents that monitor performance and ROI.</p>
            </div>
            <div class="admin-section-divider"></div>
            <!-- Agent: Evaluation Manager -->
            <div class="agent-setting-group">
                <div class="flex-between mb-2">
                    <h4>Evaluation Manager (manager)</h4>
                    <span class="status-badge success">Active</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Review Model</label>
                        <select id="agent-manager-model" class="admin-input">
                            <option value="gpt-4o" selected>GPT-4o (High Quality)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (Fast)</option>
                            <option value="deepseek-chat">DeepSeek V3 (Economical)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Temperature</label>
                        <input type="range" id="agent-manager-temp" min="0" max="1" step="0.1" value="0.2">
                        <span id="label-manager-temp">0.2</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Manager System Prompt</label>
                    <textarea id="agent-manager-prompt" class="admin-input prompt-textarea tiny"
                        placeholder="Focus on post-production evaluation and performance metrics..."></textarea>
                </div>
            </div>

            <div class="admin-section-divider mt-8 mb-8"></div>

            <!-- Agent: Reasoner Model -->
            <div class="agent-setting-group">
                <div class="flex-between mb-2">
                    <h4 style="color: var(--color-cyan);">Strategy Reasoner (reasoner)</h4>
                    <span class="status-badge info">Deep Discovery</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Reasoning Model</label>
                        <select id="agent-reasoner-model" class="admin-input">
                            <option value="deepseek-reasoner" selected>DeepSeek R1 (Deep Thinking)</option>
                            <option value="o1-preview">OpenAI o1-preview</option>
                            <option value="gpt-4o">GPT-4o (Standard Reasoning)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Reasoning Temp</label>
                        <input type="range" id="agent-reasoner-temp" min="0" max="1" step="0.1" value="0.1">
                        <span id="label-reasoner-temp">0.1</span>
                    </div>
                </div>
                <div class="form-group mt-4">
                    <label>Reasoner Master Prompt</label>
                    <textarea id="agent-reasoner-prompt" class="admin-input prompt-textarea tiny"
                        placeholder="Focus on high-level strategy, pattern recognition, and future trend analysis..."></textarea>
                </div>
            </div>

            <div class="admin-actions mt-8">
                <button id="save-growth-settings" class="admin-btn-primary">Save Growth Pipeline Settings</button>
            </div>
        </div>
    </div>
</div>

<style>
    .admin-tabs {
        display: flex;
        gap: 4px;
        margin-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 10px;
    }

    .admin-tab-btn {
        padding: 10px 20px;
        background: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.2s;
    }

    .admin-tab-btn:hover {
        background: rgba(255, 255, 255, 0.05);
        color: #fff;
    }

    .admin-tab-btn.active {
        background: rgba(0, 255, 255, 0.1);
        color: var(--color-cyan);
    }

    .admin-tab-content {
        display: none;
    }

    .admin-tab-content.active {
        display: block;
    }

    .prompt-textarea {
        height: 180px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 13px;
    }

    .prompt-textarea.tiny {
        height: 100px;
    }

    .flex-between {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    /* Workflow Builder Trigger Button */
    .workflow-builder-trigger {
        margin-bottom: 24px;
        padding: 20px;
        background: linear-gradient(135deg, rgba(0, 240, 255, 0.08) 0%, rgba(168, 85, 247, 0.08) 100%);
        border: 1px solid rgba(0, 240, 255, 0.2);
        border-radius: 16px;
        text-align: center;
    }

    .workflow-btn {
        display: inline-flex;
        align-items: center;
        gap: 12px;
        padding: 14px 28px;
        background: linear-gradient(135deg, #00f0ff 0%, #0099ff 100%);
        border: none;
        border-radius: 12px;
        color: #000;
        font-size: 15px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        position: relative;
        overflow: hidden;
    }

    .workflow-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
    }

    .workflow-btn:hover::before {
        left: 100%;
    }

    .workflow-btn:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 0 30px rgba(0, 240, 255, 0.5), 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .workflow-btn:active {
        transform: translateY(-1px) scale(0.98);
    }

    .workflow-btn-icon {
        font-size: 20px;
    }

    .workflow-btn-text {
        letter-spacing: -0.3px;
    }

    .workflow-btn-badge {
        padding: 4px 10px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 6px;
        font-size: 11px;
        font-weight: 800;
        letter-spacing: 0.5px;
    }

    .workflow-btn-desc {
        margin-top: 12px;
        color: rgba(255, 255, 255, 0.5);
        font-size: 13px;
    }

    /* ========================================
       Workflow Cards List Styles
       ======================================== */
    .workflow-list-section {
        margin-bottom: 32px;
        padding: 24px;
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 16px;
    }

    .workflow-list-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .workflow-list-header h4 {
        font-size: 16px;
        font-weight: 600;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .workflow-count {
        color: rgba(255, 255, 255, 0.5);
        font-weight: 400;
    }

    .workflow-view-all-btn {
        background: transparent;
        border: none;
        color: var(--color-cyan, #00f0ff);
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .workflow-view-all-btn:hover {
        color: #fff;
        text-decoration: underline;
    }

    .workflow-cards-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 20px;
    }

    /* Empty State */
    .workflow-empty-state {
        grid-column: 1 / -1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 48px 24px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px dashed rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        text-align: center;
    }

    .workflow-empty-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
    }

    .workflow-empty-state p {
        color: rgba(255, 255, 255, 0.6);
        font-size: 15px;
        margin-bottom: 8px;
    }

    .workflow-empty-hint {
        color: rgba(255, 255, 255, 0.4);
        font-size: 13px;
    }

    /* Workflow Card */
    .workflow-card {
        background: rgba(20, 30, 50, 0.6);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 20px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .workflow-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #00f0ff, #a855f7);
        opacity: 0;
        transition: opacity 0.3s;
    }

    .workflow-card:hover {
        border-color: rgba(0, 240, 255, 0.3);
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3), 0 0 30px rgba(0, 240, 255, 0.1);
    }

    .workflow-card:hover::before {
        opacity: 1;
    }

    .workflow-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 16px;
    }

    .workflow-card-status {
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .workflow-card-status.active {
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .workflow-card-status.draft {
        background: rgba(245, 158, 11, 0.2);
        color: #f59e0b;
        border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .workflow-card-status.archived {
        background: rgba(107, 114, 128, 0.2);
        color: #6b7280;
        border: 1px solid rgba(107, 114, 128, 0.3);
    }

    .workflow-card-header-actions {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .workflow-card-delete {
        background: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.3);
        cursor: pointer;
        padding: 6px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .workflow-card-delete:hover {
        color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
    }

    .workflow-card-delete svg {
        display: block;
    }

    .workflow-card-menu {
        background: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.4);
        cursor: pointer;
        padding: 4px 8px;
        font-size: 18px;
        transition: color 0.2s;
    }

    .workflow-card-menu:hover {
        color: #fff;
    }

    .workflow-card-title {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
    }

    .workflow-card-title-icon {
        font-size: 24px;
    }

    .workflow-card-title h5 {
        font-size: 16px;
        font-weight: 700;
        color: #fff;
        margin: 0;
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .workflow-card-meta {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 16px;
        padding-bottom: 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .workflow-card-time {
        display: flex;
        align-items: center;
        gap: 6px;
        color: rgba(255, 255, 255, 0.5);
        font-size: 12px;
    }

    /* Temperature Gauge */
    .workflow-card-temp {
        margin-bottom: 16px;
    }

    .workflow-card-temp-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.6);
    }

    .workflow-card-temp-value {
        color: #00f0ff;
        font-weight: 700;
    }

    .workflow-card-temp-bar {
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
    }

    .workflow-card-temp-fill {
        height: 100%;
        background: linear-gradient(90deg, #00f0ff, #0099ff);
        border-radius: 3px;
        transition: width 0.3s ease;
    }

    /* Stats */
    .workflow-card-stats {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
    }

    .workflow-card-stat {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 12px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 12px;
        transition: all 0.2s;
    }

    .workflow-card-stat:hover {
        background: rgba(0, 240, 255, 0.05);
        border-color: rgba(0, 240, 255, 0.2);
    }

    .workflow-card-stat-icon {
        font-size: 18px;
        margin-bottom: 4px;
    }

    .workflow-card-stat-value {
        font-size: 24px;
        font-weight: 800;
        color: #fff;
        line-height: 1;
    }

    .workflow-card-stat-label {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.5);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-top: 4px;
    }

    /* Action Buttons */
    .workflow-card-actions {
        display: flex;
        gap: 8px;
    }

    .workflow-card-action {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 10px 12px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .workflow-card-action.primary {
        background: linear-gradient(135deg, #00f0ff 0%, #0099ff 100%);
        border: none;
        color: #000;
    }

    .workflow-card-action.primary:hover {
        box-shadow: 0 0 20px rgba(0, 240, 255, 0.4);
        transform: translateY(-2px);
    }

    .workflow-card-action.secondary {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: rgba(255, 255, 255, 0.7);
    }

    .workflow-card-action.secondary:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.3);
        color: #fff;
    }
</style>

<!-- Pre-define global function before WorkflowCanvas loads -->
<script>
    // Pre-define refreshPipelineWorkflows so WorkflowCanvas can call it
    // The actual implementation will be assigned later
    window._pendingWorkflowRefreshContext = null;
    window.refreshPipelineWorkflows = function (context) {
        console.log('[Pipeline] refreshPipelineWorkflows called (pre-init), context:', context);
        // Store the context to refresh once the actual function is ready
        window._pendingWorkflowRefreshContext = context;
    };
</script>

<!-- Workflow Canvas Scripts -->
<link rel="stylesheet" href="/workflow-canvas/workflow-canvas.css">
<script src="/workflow-canvas/workflow-canvas.js"></script>
<script>
    // Global function to open workflow canvas
    function openWorkflowCanvas(context) {
        if (typeof WorkflowCanvas !== 'undefined') {
            WorkflowCanvas.open(context);
        } else {
            console.error('WorkflowCanvas not loaded');
            alert('ì›Œí¬í”Œë¡œìš° ìº”ë²„ìŠ¤ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // View all workflows
    function viewAllWorkflows(context) {
        // TODO: Navigate to full workflow list page
        console.log('View all workflows for:', context);
        alert(`${context} ì›Œí¬í”Œë¡œìš° ì „ì²´ ëª©ë¡ í˜ì´ì§€ëŠ” ê³§ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.`);
    }

    // Render workflow cards for a specific pipeline context
    function renderWorkflowCards(context, workflows) {
        const container = document.getElementById(`workflow-cards-${context}`);
        const countEl = document.getElementById(`workflow-count-${context}`);

        if (!container) return;

        if (!workflows || workflows.length === 0) {
            container.innerHTML = `
                <div class="workflow-empty-state">
                    <span class="workflow-empty-icon">ğŸ“­</span>
                    <p>ì €ì¥ëœ ì›Œí¬í”Œë¡œìš°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    <span class="workflow-empty-hint">ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒˆ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•˜ì„¸ìš”</span>
                </div>
            `;
            if (countEl) countEl.textContent = '(0)';
            return;
        }

        if (countEl) countEl.textContent = `(${workflows.length})`;

        container.innerHTML = workflows.map(wf => `
            <div class="workflow-card" data-workflow-id="${wf.id}">
                <div class="workflow-card-header">
                    <span class="workflow-card-status ${wf.status || 'draft'}">${wf.status || 'Draft'}</span>
                    <button class="workflow-card-menu" onclick="showWorkflowMenu('${wf.id}')">â‹®</button>
                </div>
                
                <div class="workflow-card-title">
                    <span class="workflow-card-title-icon">ğŸ“‹</span>
                    <h5>${wf.name || 'Untitled Workflow'}</h5>
                </div>
                
                <div class="workflow-card-meta">
                    <span class="workflow-card-time">
                        <span>ğŸ•</span>
                        <span>${formatRelativeTime(wf.createdAt)}</span>
                    </span>
                </div>
                
                <div class="workflow-card-temp">
                    <div class="workflow-card-temp-label">
                        <span>ğŸŒ¡ï¸ Temperature</span>
                        <span class="workflow-card-temp-value">${wf.temperature || 0.7}</span>
                    </div>
                    <div class="workflow-card-temp-bar">
                        <div class="workflow-card-temp-fill" style="width: ${(wf.temperature || 0.7) * 100}%"></div>
                    </div>
                </div>
                
                <div class="workflow-card-stats">
                    <div class="workflow-card-stat">
                        <span class="workflow-card-stat-icon">ğŸ‘¥</span>
                        <span class="workflow-card-stat-value">${wf.agentCount || 0}</span>
                        <span class="workflow-card-stat-label">Agents</span>
                    </div>
                    <div class="workflow-card-stat">
                        <span class="workflow-card-stat-icon">ğŸ“„</span>
                        <span class="workflow-card-stat-value">${wf.contentCount || 0}</span>
                        <span class="workflow-card-stat-label">Contents</span>
                    </div>
                </div>
                
                <div class="workflow-card-actions">
                    <button class="workflow-card-action primary" onclick="runWorkflow('${wf.id}')">
                        <span>â–¶</span>
                        <span>ì‹¤í–‰</span>
                    </button>
                    <button class="workflow-card-action secondary" onclick="editWorkflow('${wf.id}', '${context}')">
                        <span>âœï¸</span>
                        <span>í¸ì§‘</span>
                    </button>
                    <button class="workflow-card-action secondary" onclick="duplicateWorkflow('${wf.id}')">
                        <span>ğŸ“‹</span>
                        <span>ë³µì œ</span>
                    </button>
                </div>
            </div>
        `).join('');
    }

    // Format relative time
    function formatRelativeTime(timestamp) {
        if (!timestamp) return 'ë°©ê¸ˆ ì „';

        const now = new Date();
        const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMins / 60);
        const diffDays = Math.floor(diffHours / 24);

        if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
        if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
        if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
        if (diffDays < 7) return `${diffDays}ì¼ ì „`;
        return date.toLocaleDateString('ko-KR');
    }

    // Workflow actions
    function runWorkflow(workflowId) {
        console.log('Running workflow:', workflowId);
        alert('ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ê¸°ëŠ¥ì€ ê³§ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.');
    }

    function editWorkflow(workflowId, context) {
        console.log('Editing workflow:', workflowId, 'in context:', context);
        if (typeof WorkflowCanvas !== 'undefined') {
            // Pass workflowId to load the existing definition
            WorkflowCanvas.open(context, null, workflowId);
        }
    }

    function duplicateWorkflow(workflowId) {
        console.log('Duplicating workflow:', workflowId);
        alert('ì›Œí¬í”Œë¡œìš° ë³µì œ ê¸°ëŠ¥ì€ ê³§ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.');
    }

    function showWorkflowMenu(workflowId) {
        console.log('Show menu for:', workflowId);
        // TODO: Implement context menu
    }

    // Load workflows for all pipeline contexts
    async function loadAllPipelineWorkflows() {
        const contexts = ['market', 'brand', 'knowledge', 'studio', 'growth'];

        // Wait for Firebase to be ready
        if (typeof firebase === 'undefined' || !firebase.firestore) {
            console.log('[Pipeline] Waiting for Firebase...');
            setTimeout(loadAllPipelineWorkflows, 500);
            return;
        }

        const db = firebase.firestore();

        for (const context of contexts) {
            try {
                const snapshot = await db.collection('workflowDefinitions')
                    .where('pipelineContext', '==', context)
                    .orderBy('createdAt', 'desc')
                    .limit(6)
                    .get();

                const workflows = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                console.log(`[Pipeline] Loaded ${workflows.length} workflows for ${context}`);
                renderWorkflowCards(context, workflows);
            } catch (err) {
                console.error(`Failed to load workflows for ${context}:`, err);
                // Check if it's a missing index error
                if (err.code === 'failed-precondition' && err.message.includes('index')) {
                    console.warn(`[Pipeline] Missing index for ${context}. Loading without orderBy.`);
                    try {
                        const snapshot = await db.collection('workflowDefinitions')
                            .where('pipelineContext', '==', context)
                            .limit(6)
                            .get();

                        const workflows = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        renderWorkflowCards(context, workflows);
                    } catch (fallbackErr) {
                        renderWorkflowCards(context, []);
                    }
                } else {
                    renderWorkflowCards(context, []);
                }
            }
        }
    }

    // Load workflows for a single context (for refresh)
    async function loadPipelineWorkflows(context) {
        console.log('[Pipeline] loadPipelineWorkflows called for context:', context);
        if (typeof firebase === 'undefined' || !firebase.firestore) {
            console.error('[Pipeline] Firebase not ready');
            return;
        }

        const db = firebase.firestore();
        try {
            console.log('[Pipeline] Querying workflowDefinitions where pipelineContext ==', context);
            const snapshot = await db.collection('workflowDefinitions')
                .where('pipelineContext', '==', context)
                .orderBy('createdAt', 'desc')
                .limit(6)
                .get();

            const workflows = snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data()
            }));

            console.log('[Pipeline] Found', workflows.length, 'workflows for context:', context);
            renderWorkflowCards(context, workflows);
        } catch (err) {
            console.error(`Refresh failed for ${context}:`, err);
            // Fallback without orderBy if index missing
            if (err.code === 'failed-precondition') {
                console.warn('[Pipeline] Trying fallback without orderBy...');
                try {
                    const snapshot = await db.collection('workflowDefinitions')
                        .where('pipelineContext', '==', context)
                        .limit(6)
                        .get();
                    const workflows = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    console.log('[Pipeline] Fallback found', workflows.length, 'workflows');
                    renderWorkflowCards(context, workflows);
                } catch (fallbackErr) {
                    console.error('[Pipeline] Fallback also failed:', fallbackErr);
                }
            }
        }
    }

    // Listen for workflow saved events
    window.addEventListener('workflowSaved', (e) => {
        const { context } = e.detail;
        console.log('[Pipeline] âœ… workflowSaved event received! Refreshing context:', context);
        loadPipelineWorkflows(context);
    });

    // Re-define the global function now that loadPipelineWorkflows is available
    window.refreshPipelineWorkflows = function (context) {
        console.log('[Pipeline] ğŸ”„ refreshPipelineWorkflows called (real impl) for:', context);
        loadPipelineWorkflows(context);
    };

    // Check for pending refresh that was called before this script loaded
    if (window._pendingWorkflowRefreshContext) {
        console.log('[Pipeline] Processing pending refresh for:', window._pendingWorkflowRefreshContext);
        loadPipelineWorkflows(window._pendingWorkflowRefreshContext);
        window._pendingWorkflowRefreshContext = null;
    }

    // Initialize when pipeline page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadAllPipelineWorkflows);
    } else {
        loadAllPipelineWorkflows();
    }
</script>