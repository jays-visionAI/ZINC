<div class="admin-card">
    <div style="margin-bottom: 24px;">
        <h3 style="margin: 0;">System Settings</h3>
        <p style="margin: 4px 0 0 0; color: rgba(255,255,255,0.5); font-size: 14px;">
            Configure global system settings, API keys, and pricing.
        </p>
    </div>

    <!-- Main Tabs -->
    <div style="display: flex; gap: 24px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 24px;">
        <div class="settings-tab active" onclick="switchSettingsTab('system')" id="tab-btn-system"
            style="padding-bottom: 12px; cursor: pointer; border-bottom: 2px solid #16e0bd; color: #fff; font-weight: 600;">
            üõ†Ô∏è System (API)
        </div>
        <div class="settings-tab" onclick="switchSettingsTab('pricing')" id="tab-btn-pricing"
            style="padding-bottom: 12px; cursor: pointer; border-bottom: 2px solid transparent; color: rgba(255,255,255,0.5);">
            üí∞ Pricing & Credits
        </div>
    </div>

    <!-- ========================================== -->
    <!-- TAB 1: SYSTEM (LLM, GenAI, Maintenance)    -->
    <!-- ========================================== -->
    <div id="tab-system" class="settings-tab-content">

        <!-- Internal Sub-Tabs for System -->
        <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;">
            <button class="admin-btn-secondary"
                onclick="document.getElementById('sys-sub-llm').scrollIntoView({behavior: 'smooth'})">LLM
                Providers</button>
            <button class="admin-btn-secondary"
                onclick="document.getElementById('sys-sub-models').scrollIntoView({behavior: 'smooth'})">üìä LLM
                Models</button>
            <button class="admin-btn-secondary"
                onclick="document.getElementById('sys-sub-policies').scrollIntoView({behavior: 'smooth'})">üéØ Feature
                Policies</button>
            <button class="admin-btn-secondary"
                onclick="document.getElementById('sys-sub-genai').scrollIntoView({behavior: 'smooth'})">Gen AI</button>
            <button class="admin-btn-secondary"
                onclick="document.getElementById('sys-sub-main').scrollIntoView({behavior: 'smooth'})">Maintenance</button>
        </div>

        <!-- 1.1 LLM Providers -->
        <div id="sys-sub-llm"
            style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 24px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h4 style="margin: 0; color: #fff;">LLM Providers</h4>
                <button id="btn-add-provider-settings" class="admin-btn-primary" style="padding: 8px 16px;"
                    onclick="if(window.openProviderModal) window.openProviderModal(); else document.getElementById('provider-modal-settings').style.display='flex';">
                    + Add Provider
                </button>
            </div>
            <p style="font-size: 12px; color: rgba(255,255,255,0.4); margin-bottom: 16px;">
                Manage LLM API keys for text generation (GPT, Claude, Gemini).
            </p>
            <div id="providers-table-container">
                <table class="admin-table" style="width: 100%;">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Provider</th>
                            <th>Status</th>
                            <th>Models</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="providers-table-body-settings">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px;">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 1.2 LLM Models (Cost Table) - PRD 11.6 -->
        <div id="sys-sub-models"
            style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 24px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div>
                    <h4 style="margin: 0; color: #fff;">üìä LLM Models & Pricing</h4>
                    <p style="font-size: 12px; color: rgba(255,255,255,0.4); margin: 4px 0 0 0;">
                        Model catalog with cost per 1K tokens. This is ZYNK's internal cost reference.
                    </p>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button onclick="refreshLLMModels()" class="admin-btn-secondary">üîÑ Refresh</button>
                    <button onclick="seedLLMRouterData()" class="admin-btn-primary">+ Seed Models</button>
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table class="admin-table" style="width: 100%; min-width: 900px;">
                    <thead>
                        <tr>
                            <th>Model</th>
                            <th>Provider</th>
                            <th>Tier</th>
                            <th>Input $/1K</th>
                            <th>Output $/1K</th>
                            <th>Credit/1K</th>
                            <th>Context</th>
                            <th>Code Ready</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="llm-models-table-body">
                        <tr>
                            <td colspan="10" style="text-align: center; padding: 20px;">Loading models...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div
                style="margin-top: 16px; padding: 12px; background: rgba(22, 224, 189, 0.1); border-radius: 8px; border: 1px solid rgba(22, 224, 189, 0.2);">
                <p style="margin: 0; font-size: 12px; color: #16e0bd;">
                    üí° <strong>Tier Legend:</strong>
                    <span style="color: #10b981;">Economy</span> (0.1-0.3x) |
                    <span style="color: #eab308;">Standard</span> (1.0x) |
                    <span style="color: #f43f5e;">Premium</span> (2.5x+)
                </p>
            </div>
        </div>

        <!-- 1.3 Feature Policies - PRD 11.6 -->
        <div id="sys-sub-policies"
            style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 24px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div>
                    <h4 style="margin: 0; color: #fff;">üéØ Feature Policies (LLM Routing)</h4>
                    <p style="font-size: 12px; color: rgba(255,255,255,0.4); margin: 4px 0 0 0;">
                        Define which model to use for each feature. DEFAULT = Standard, BOOST = Premium.
                    </p>
                </div>
                <button onclick="refreshFeaturePolicies()" class="admin-btn-secondary">üîÑ Refresh</button>
            </div>
            <div style="overflow-x: auto;">
                <table class="admin-table" style="width: 100%; min-width: 800px;">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Category</th>
                            <th>Default Model</th>
                            <th>Default Credit</th>
                            <th>Boost Model</th>
                            <th>Boost Credit</th>
                            <th>Force?</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="feature-policies-table-body">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 20px;">Loading policies...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div
                style="margin-top: 16px; padding: 12px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.2);">
                <p style="margin: 0; font-size: 12px; color: #818cf8;">
                    üöÄ <strong>Booster Mode:</strong> When users enable "Boost", the system uses the Boost Model with
                    higher credit cost (2.5x).
                    Force Mode overrides all user choices.
                </p>
            </div>
        </div>

        <!-- 1.4 Gen AI Providers -->
        <div id="sys-sub-genai"
            style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 24px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div>
                    <h4 style="margin: 0; color: #fff;">Image Generation Providers</h4>
                    <p style="font-size: 12px; color: rgba(255,255,255,0.4); margin: 4px 0 0 0;">
                        Configure AI image generation services.
                    </p>
                </div>
                <button id="btn-refresh-genai" class="admin-btn-secondary">üîÑ Refresh</button>
            </div>

            <div id="genai-providers-container"
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">
                <!-- Provider Cards (Flux, Stability, DALL-E, Ideogram, Imagen) -->
                <!-- Flux Pro -->
                <div class="genai-provider-card" data-provider="flux"
                    style="background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div
                            style="width: 40px; height: 40px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            üöÄ</div>
                        <div>
                            <h5 style="margin: 0; color: #fff;">Flux Pro</h5>
                            <p style="margin: 0; font-size: 11px; color: rgba(255,255,255,0.4);">via Replicate</p>
                        </div>
                        <div id="flux-status"
                            style="margin-left: auto; padding: 4px 10px; border-radius: 20px; font-size: 11px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.5);">
                            Not configured</div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <input type="password" id="genai-flux-key" class="admin-input" placeholder="API Key (Replicate)"
                            style="font-size: 13px;">
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="saveGenAIProvider('flux')" class="admin-btn-primary"
                            style="flex: 1;">Save</button>
                        <button onclick="testGenAIProvider('flux')" class="admin-btn-secondary">Test</button>
                    </div>
                </div>
                <!-- Stability -->
                <div class="genai-provider-card" data-provider="stability"
                    style="background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div
                            style="width: 40px; height: 40px; background: linear-gradient(135deg, #ec4899, #f43f5e); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            üé®</div>
                        <div>
                            <h5 style="margin: 0; color: #fff;">Stability AI</h5>
                            <p style="margin: 0; font-size: 11px; color: rgba(255,255,255,0.4);">SDXL 1.0</p>
                        </div>
                        <div id="stability-status"
                            style="margin-left: auto; padding: 4px 10px; border-radius: 20px; font-size: 11px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.5);">
                            Not configured</div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <input type="password" id="genai-stability-key" class="admin-input" placeholder="API Key"
                            style="font-size: 13px;">
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="saveGenAIProvider('stability')" class="admin-btn-primary"
                            style="flex: 1;">Save</button>
                        <button onclick="testGenAIProvider('stability')" class="admin-btn-secondary">Test</button>
                    </div>
                </div>
                <!-- DALL-E -->
                <div class="genai-provider-card" data-provider="dalle"
                    style="background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div
                            style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981, #14b8a6); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            üñºÔ∏è</div>
                        <div>
                            <h5 style="margin: 0; color: #fff;">DALL-E 3</h5>
                            <p style="margin: 0; font-size: 11px; color: rgba(255,255,255,0.4);">Use LLM Key</p>
                        </div>
                        <div id="dalle-status"
                            style="margin-left: auto; padding: 4px 10px; border-radius: 20px; font-size: 11px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.5);">
                            Auto</div>
                    </div>
                    <div
                        style="font-size: 12px; color: #10b981; padding: 10px; background: rgba(16,185,129,0.1); border-radius: 6px;">
                        Uses OpenAI key from LLM Providers.
                    </div>
                </div>
                <!-- Ideogram -->
                <div class="genai-provider-card" data-provider="ideogram"
                    style="background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div
                            style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b, #eab308); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            ‚ú®</div>
                        <div>
                            <h5 style="margin: 0; color: #fff;">Ideogram</h5>
                            <p style="margin: 0; font-size: 11px; color: rgba(255,255,255,0.4);">Best for Text</p>
                        </div>
                        <div id="ideogram-status"
                            style="margin-left: auto; padding: 4px 10px; border-radius: 20px; font-size: 11px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.5);">
                            Not configured</div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <input type="password" id="genai-ideogram-key" class="admin-input" placeholder="API Key"
                            style="font-size: 13px;">
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="saveGenAIProvider('ideogram')" class="admin-btn-primary"
                            style="flex: 1;">Save</button>
                        <button onclick="testGenAIProvider('ideogram')" class="admin-btn-secondary">Test</button>
                    </div>
                </div>
            </div>

            <div style="margin-top: 24px;">
                <h5 style="margin: 0 0 12px 0; color: #fff;">Default Image Provider</h5>
                <div style="display:flex; gap:12px;">
                    <select id="default-genai-provider" class="admin-input" style="max-width: 300px;">
                        <option value="flux">Flux Pro (Recommended)</option>
                        <option value="stability">Stability AI</option>
                        <option value="dalle">DALL-E 3</option>
                        <option value="ideogram">Ideogram</option>
                    </select>
                    <button onclick="saveDefaultProvider()" class="admin-btn-primary">Save Default</button>
                </div>
            </div>
        </div>

        <!-- 1.3 System Maintenance -->
        <div id="sys-sub-main"
            style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 24px; border: 1px solid rgba(255,255,255,0.05);">
            <h4 style="margin: 0 0 16px 0; color: #fff;">System Maintenance</h4>

            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                <div>
                    <strong style="display: block; color: #e2e8f0; margin-bottom: 4px;">Update Sub-Agent
                        Prompts</strong>
                    <p style="margin: 0; font-size: 12px; color: rgba(255,255,255,0.4);">Injects high-quality system
                        prompts for Planner, Creator, and Manager.</p>
                </div>
                <button id="update-prompts-btn" class="admin-btn-secondary">Update Prompts</button>
            </div>

            <!-- System Prompt Templates Section -->
            <div style="margin-top: 24px; background: rgba(255,255,255,0.03); border-radius: 8px; padding: 24px; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: all 0.2s;"
                onclick="window.location.href='admin-prompt-templates.html'"
                onmouseover="this.style.background='rgba(255,255,255,0.05)'"
                onmouseout="this.style.background='rgba(255,255,255,0.03)'">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div style="font-size: 24px;">üìù</div>
                    <div>
                        <h4 style="margin: 0 0 4px 0; color: #fff;">System Prompt Templates</h4>
                        <p style="margin: 0; font-size: 13px; color: rgba(255,255,255,0.5);">Manage and version control
                            system prompts for all agents.</p>
                    </div>
                </div>
            </div>

            <!-- Chatbot Configuration Link (Restored) -->
            <div style="margin-top: 16px; background: rgba(255,255,255,0.03); border-radius: 8px; padding: 24px; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: all 0.2s;"
                onclick="window.location.href='#chatbot'" onmouseover="this.style.background='rgba(255,255,255,0.05)'"
                onmouseout="this.style.background='rgba(255,255,255,0.03)'">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div style="font-size: 24px;">ü§ñ</div>
                    <div>
                        <h4 style="margin: 0 0 4px 0; color: #fff;">Chatbot Configuration</h4>
                        <p style="margin: 0; font-size: 13px; color: rgba(255,255,255,0.5);">Go to separate Chatbot
                            Settings page.</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- ========================================== -->
    <!-- TAB 4: PRICING & CREDITS                   -->
    <!-- ========================================== -->
    <div id="tab-pricing" class="settings-tab-content" style="display: none;">
        <!-- Subscription Plans Section -->
        <div
            style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 24px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h4 style="margin: 0; color: #fff;">Subscription Plans (Monthly)</h4>
                <button onclick="savePricingData()" class="admin-btn-primary" style="padding: 6px 16px;">Save
                    Changes</button>
            </div>
            <div style="overflow-x: auto;">
                <table class="admin-table" style="width: 100%; min-width: 600px;">
                    <thead>
                        <tr>
                            <th>Plan (ID)</th>
                            <th>Price ($)</th>
                            <th>Base Credits</th>
                            <th>Seats</th>
                            <th>Agents</th>
                            <th>Top-up Bonus (%)</th>
                        </tr>
                    </thead>
                    <tbody id="pricing-plans-body">
                        <tr>
                            <td colspan="6" style="text-align:center;">Loading plans...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Top-up Packs Section -->
        <div
            style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 24px; border: 1px solid rgba(255,255,255,0.05);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h4 style="margin: 0; color: #fff;">Credit Top-up Packs</h4>
            </div>
            <table class="admin-table" style="width: 100%;">
                <thead>
                    <tr>
                        <th>Pack Name</th>
                        <th>Price ($)</th>
                        <th>Base Credits</th>
                        <th>Preview (Starter)</th>
                        <th>Preview (Enterprise +30%)</th>
                    </tr>
                </thead>
                <tbody id="pricing-packs-body">
                    <tr>
                        <td colspan="5" style="text-align:center;">Loading packs...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Credit Action Costs Section -->
        <div
            style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 24px; border: 1px solid rgba(255,255,255,0.05); margin-top: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h4 style="margin: 0; color: #fff;">Credit Action Costs</h4>
                <div style="display: flex; gap: 8px;">
                    <button onclick="if(confirm('Reset all costs to system defaults?')) seedCreditCosts()"
                        class="admin-btn-secondary">Reset Defaults</button>
                    <button onclick="saveActionCosts()" class="admin-btn-primary">Save Costs</button>
                </div>
            </div>
            <table class="admin-table" style="width: 100%;">
                <thead>
                    <tr>
                        <th>Action Name</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Cost (Credits)</th>
                    </tr>
                </thead>
                <tbody id="pricing-actions-body">
                    <tr>
                        <td colspan="4" style="text-align:center;">Loading costs...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- Provider Modal -->
<div id="provider-modal-settings" class="modal-overlay" style="display: none;">
    <div class="modal-container" style="max-width: 600px;">
        <div class="modal-header">
            <h3 id="provider-modal-title-settings">Add LLM Provider</h3><button class="modal-close"
                onclick="closeProviderModalSettings()">√ó</button>
        </div>
        <div class="modal-body">
            <form id="provider-form-settings">
                <input type="hidden" id="provider-doc-id-settings">
                <div class="form-group"><label>Provider Type</label><select id="provider-type-settings"
                        class="admin-input">
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                        <option value="gemini">Google Gemini</option>
                        <option value="custom">Custom</option>
                    </select></div>
                <div class="form-group"><label>Name</label><input type="text" id="provider-name-settings"
                        class="admin-input"></div>
                <div class="form-group"><label>API Key</label><input type="password" id="provider-api-key-settings"
                        class="admin-input"></div>
                <div class="form-group"><label>Models</label><input type="text" id="provider-models-settings"
                        class="admin-input" placeholder="gpt-4o, ..."></div>
                <div class="form-group"><label>Status</label><select id="provider-status-settings" class="admin-input">
                        <option value="active">Active</option>
                        <option value="disabled">Disabled</option>
                    </select></div>
            </form>
        </div>
        <div class="modal-footer"><button class="admin-btn-secondary"
                onclick="closeProviderModalSettings()">Cancel</button><button class="admin-btn-primary"
                id="btn-save-provider-settings">Save Provider</button></div>
    </div>
</div>

<style>
    /* Shared Settings Styles */
    .admin-input {
        width: 100%;
        padding: 8px 12px;
        background: #2a2a30;
        border: 1px solid #444;
        border-radius: 4px;
        color: white;
        margin-bottom: 8px;
    }

    .color-input-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .color-input-wrapper input[type="color"] {
        width: 32px;
        height: 32px;
        border: none;
        background: none;
        cursor: pointer;
    }

    .admin-table th {
        text-align: left;
        padding: 10px;
        color: #888;
        border-bottom: 1px solid #333;
    }

    .admin-table td {
        padding: 10px;
        border-bottom: 1px solid #222;
    }
</style>

<script>
    // Tab switching function
    function switchSettingsTab(tabId) {
        // Update tab buttons
        document.querySelectorAll('.settings-tab').forEach(btn => {
            btn.style.borderBottomColor = 'transparent';
            btn.style.color = 'rgba(255,255,255,0.5)';
            btn.style.fontWeight = 'normal';
            btn.classList.remove('active');
        });
        const activeBtn = document.getElementById('tab-btn-' + tabId);
        if (activeBtn) {
            activeBtn.style.borderBottomColor = '#16e0bd';
            activeBtn.style.color = '#fff';
            activeBtn.style.fontWeight = '600';
            activeBtn.classList.add('active');
        }

        // Show/hide content
        document.querySelectorAll('.settings-tab-content').forEach(content => {
            content.style.display = 'none';
        });
        const activeContent = document.getElementById('tab-' + tabId);
        if (activeContent) {
            activeContent.style.display = 'block';
        }

        // Initialize Module if needed
        if (tabId === 'genai') { // (Old, now part of system)
            loadGenAIProviders();
        }
        if (tabId === 'system') {
            // Re-init system tab stuff if needed
            if (window.loadGenAIProviders) window.loadGenAIProviders();
        }
        else if (tabId === 'pricing') {
            if (window.loadPricingData) window.loadPricingData();
        }
    }

    // Auto-initialize
    if (typeof window.initSettings === 'function') {
        window.initSettings();
    }
</script>