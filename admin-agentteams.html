<div class="admin-actions-bar">
    <div class="admin-search-box">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input type="text" id="agentteam-search" placeholder="Search templates...">
    </div>

    <div class="admin-filters">
        <select id="filter-status" class="admin-select">
            <option value="all">All Status</option>
            <option value="active">‚úÖ Active</option>
            <option value="draft">üìù Draft</option>
            <option value="deprecated">‚ùå Deprecated</option>
        </select>

        <button class="admin-btn-primary" id="add-agentteam-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Create Agent Template
        </button>
    </div>
</div>

<!-- Template Detail Modal (Included from template-detail.html) -->
<div id="template-detail-modal" class="admin-modal" style="display: none;">
    <div class="modal-content template-detail-content">
        <!-- Header -->
        <div class="template-detail-header">
            <div class="header-left">
                <h1 id="template-detail-title">Template Name</h1>
                <p class="template-id" id="template-detail-id">ID: ...</p>
            </div>
            <div class="header-right">
                <span class="badge" id="template-detail-status">Status</span>
                <span class="badge badge-secondary" id="template-detail-version">v...</span>
                <button class="btn-close" onclick="closeTemplateDetail()">√ó</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="template-detail-body">
            <!-- Left Column: Template Information -->
            <div class="detail-column">
                <div class="detail-section">
                    <h3 class="section-title">Template Information</h3>

                    <div class="info-group">
                        <label>Name</label>
                        <p id="detail-name">-</p>
                    </div>

                    <div class="info-group">
                        <label>Description</label>
                        <p id="detail-description" class="text-muted">-</p>
                    </div>



                    <div class="info-row">
                        <div class="info-group">
                            <label>Version</label>
                            <p id="detail-version-text">-</p>
                        </div>
                        <div class="info-group">
                            <label>Status</label>
                            <p>
                                <span class="status-indicator" id="detail-status-indicator"></span>
                                <span id="detail-status-text">-</span>
                            </p>
                        </div>
                    </div>

                    <div class="info-group">
                        <label>Created</label>
                        <p id="detail-created">-</p>
                    </div>

                    <div class="info-group">
                        <label>Last Updated</label>
                        <p id="detail-updated">-</p>
                    </div>

                    <div class="info-group">
                        <label>Created By</label>
                        <p id="detail-created-by">-</p>
                    </div>
                </div>
            </div>

            <!-- Center Column: Roles Configuration -->
            <div class="detail-column">
                <div class="detail-section">
                    <h3 class="section-title"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <span>
                            Sub-Agents
                            <span class="role-count" id="role-count">(0)</span>
                        </span>
                        <button class="btn-sm btn-secondary" onclick="openAddSubAgentModal()"
                            style="font-size: 11px; padding: 4px 10px; height: 24px; line-height: 1;">
                            + Add Sub-Agent
                        </button>
                    </h3>

                    <div id="roles-list" class="roles-list">
                        <!-- Roles will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <!-- Right Column: Deployment Stats -->
            <div class="detail-column">
                <div class="detail-section">
                    <h3 class="section-title">Deployment Statistics</h3>

                    <div class="stat-card">
                        <div class="stat-item">
                            <span class="stat-label">Active Deployments</span>
                            <span class="stat-value stat-success" id="active-deployments">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Deployments</span>
                            <span class="stat-value" id="total-deployments">0</span>
                        </div>
                    </div>

                    <h4 class="subsection-title">Recent Deployments</h4>
                    <div id="recent-deployments" class="deployments-list">
                        <!-- Deployments will be dynamically inserted here -->
                    </div>

                    <button class="btn-secondary btn-full" onclick="viewAllDeployments()">
                        View All Deployments
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="template-detail-footer">
            <button class="btn-primary" onclick="editCurrentTemplate()">
                <span>‚úèÔ∏è</span> Edit Template
            </button>
            <button class="btn-secondary" onclick="duplicateCurrentTemplate()">
                <span>üìã</span> Duplicate
            </button>
            <button class="btn-danger-outline" onclick="deleteCurrentTemplate()">
                <span>üóëÔ∏è</span> Delete
            </button>
        </div>
    </div>
</div>

<div class="admin-table-container">
    <table class="admin-table">
        <thead>
            <tr>
                <th>Agent Team Name</th>
                <th>Version</th>
                <th># of Sub-Agents</th>
                <th>Status</th>
                <th>Last Updated</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="agentteams-table-body">
            <tr>
                <td colspan="7" style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                    Loading templates...
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Add Sub-Agent Modal -->
<div id="add-subagent-modal" class="admin-modal" style="display: none; z-index: 1100;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3>Add Sub-Agent</h3>
            <button class="btn-close" onclick="closeAddSubAgentModal()">√ó</button>
        </div>
        <div class="modal-body">
            <div class="admin-search-box" style="margin-bottom: 16px; width: 100%;">
                <input type="text" id="subagent-search" placeholder="Search sub-agents..." onkeyup="filterSubAgents()"
                    style="width: 100%;">
            </div>
            <div id="available-subagents-list" class="available-subagents-list"
                style="max-height: 400px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px;">
                <!-- List items will be injected here -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeAddSubAgentModal()">Cancel</button>
        </div>
    </div>
</div>

<!-- Create Template Wizard Modal -->
<div id="agentteam-modal" class="admin-modal" style="display: none;">
    <div class="admin-modal-content"
        style="max-width: 900px; min-height: 600px; display: flex; flex-direction: column;">

        <!-- Wizard Header -->
        <div class="admin-modal-header">
            <div>
                <h3 class="admin-modal-title" id="modal-title">Create Agent Team Template</h3>
                <div style="font-size: 13px; color: rgba(255,255,255,0.5); margin-top: 4px;">
                    Step <span id="wizard-step-num">1</span> of 4: <span id="wizard-step-title">Basic Info</span>
                </div>
            </div>
            <button class="admin-modal-close" id="agentteam-modal-close">&times;</button>
        </div>

        <!-- Wizard Progress Bar -->
        <div style="background: rgba(255,255,255,0.1); height: 4px; width: 100%;">
            <div id="wizard-progress"
                style="background: #16e0bd; height: 100%; width: 25%; transition: width 0.3s ease;"></div>
        </div>

        <!-- Wizard Body -->
        <div class="admin-modal-body" style="flex: 1; overflow-y: auto; padding: 24px;">
            <form id="agentteam-form">
                <input type="hidden" id="agentteam-id">

                <!-- Step 1: Basic Info -->
                <div id="step-1" class="wizard-step">
                    <div class="admin-form-group">
                        <label class="admin-form-label">1. Agent Team Name <span
                                style="color: #ef4444;">*</span></label>
                        <input type="text" id="team-name" class="admin-form-input" placeholder="e.g. Marketing Team"
                            required>
                        <small style="color: rgba(255,255,255,0.5);">Enter a descriptive name for this agent team
                            template.</small>
                    </div>

                    <div class="admin-form-group">
                        <label class="admin-form-label">2. Description</label>
                        <textarea id="team-description" class="admin-form-input" rows="3"
                            placeholder="Describe the purpose and capabilities of this team..."></textarea>
                    </div>

                    <div class="admin-form-group">
                        <label class="admin-form-label">3. Status</label>
                        <select id="team-status" class="admin-select" style="width: 100%;" required>
                            <option value="active">‚úÖ Active</option>
                            <option value="draft">üìù Draft</option>
                        </select>
                    </div>
                </div>

                <!-- Step 2: Role Configuration -->
                <div id="step-2" class="wizard-step" style="display: none;">
                    <div style="margin-bottom: 16px;">
                        <p style="margin: 0 0 12px 0; color: rgba(255,255,255,0.7);">
                            Configure the Sub-Agent roles for this team. Select engines and define their
                            responsibilities.
                        </p>

                        <!-- Control Buttons -->
                        <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                            <button type="button" onclick="toggleAllRoles(true)" class="btn-sm btn-secondary">Select
                                All</button>
                            <button type="button" onclick="toggleAllRoles(false)" class="btn-sm btn-secondary">Deselect
                                All</button>
                        </div>

                        <!-- Header Row -->
                        <div
                            style="display: grid; grid-template-columns: 40px 1.5fr 1.5fr 80px 80px; gap: 12px; padding: 8px 12px; background: rgba(255,255,255,0.1); border-radius: 4px; font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.8); margin-bottom: 8px;">
                            <div style="text-align: center;">Use</div>
                            <div>Engine Type</div>
                            <div>Role Name (In Team)</div>
                            <div style="text-align: center;">Required</div>
                            <div style="text-align: center;">Active</div>
                        </div>

                        <!-- Roles List -->
                        <div id="wizard-roles-list"
                            style="display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto;">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>


                <!-- Step 3: Runtime Configuration (Auto-Assigned) -->
                <div id="step-3" class="wizard-step" style="display: none;">
                    <div style="margin-bottom: 16px;">
                        <p style="margin: 0 0 12px 0; color: rgba(255,255,255,0.7);">
                            Runtime configurations are automatically assigned based on each role's engine type,
                            language, and tier preferences.
                            <strong>No manual selection required.</strong>
                        </p>

                        <div
                            style="background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#60a5fa"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                                <span style="color: #60a5fa; font-size: 13px;">
                                    Configurations are resolved from <strong>runtimeProfileRules</strong> collection
                                    using smart fallback logic.
                                </span>
                            </div>
                        </div>

                        <div id="wizard-runtime-auto-list" style="display: flex; flex-direction: column; gap: 12px;">
                            <!-- Dynamically populated with auto-assigned configs -->
                        </div>
                    </div>
                </div>

                <!-- Step 4: Review & Create -->
                <div id="step-4" class="wizard-step" style="display: none;">
                    <div
                        style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; margin-bottom: 24px;">
                        <h4 style="margin: 0 0 12px 0; color: #16e0bd;">Template Summary</h4>
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 8px; font-size: 14px;">
                            <div style="color: rgba(255,255,255,0.5);">Name:</div>
                            <div id="review-name" style="font-weight: 600;">-</div>

                            <div style="color: rgba(255,255,255,0.5);">Description:</div>
                            <div id="review-desc">-</div>

                            <div style="color: rgba(255,255,255,0.5);">Sub-Agents:</div>
                            <div id="review-count" style="font-weight: 600; color: #16e0bd;">0</div>
                        </div>
                    </div>

                    <h4 style="margin: 0 0 12px 0;">Included Roles Configuration</h4>
                    <div id="review-agents-list" style="display: flex; flex-direction: column; gap: 8px;">
                        <!-- Dynamically populated -->
                    </div>
                </div>

            </form>
        </div>

        <!-- Wizard Footer -->
        <div class="admin-modal-footer" style="justify-content: space-between;">
            <button class="admin-btn-secondary" id="wizard-prev" style="visibility: hidden;">Back</button>
            <div style="display: flex; gap: 12px;">
                <button class="admin-btn-secondary" id="agentteam-modal-cancel">Cancel</button>
                <button class="admin-btn-primary" id="wizard-next">Next Step</button>
            </div>
        </div>
    </div>
</div>

<style>
    /* Sub-Agent Card Runtime Styles */
    .sub-agent-runtime-section {
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 12px;
    }

    .runtime-summary {
        display: flex;
        align-items: center;
        gap: 8px;
        color: rgba(255, 255, 255, 0.7);
    }

    .runtime-indicator {
        color: #22c55e;
        font-size: 8px;
    }

    .runtime-text {
        font-family: 'JetBrains Mono', monospace;
        letter-spacing: -0.02em;
    }

    .runtime-loading {
        color: rgba(255, 255, 255, 0.4);
        font-style: italic;
    }

    .runtime-error {
        color: #ef4444;
    }

    .text-purple {
        color: #a855f7;
    }

    .text-green {
        color: #22c55e;
    }

    .text-blue {
        color: #3b82f6;
    }

    /* Tooltip Styles */
    .runtime-info-icon {
        position: relative;
        cursor: help;
        opacity: 0.6;
        transition: opacity 0.2s;
    }

    .runtime-info-icon:hover {
        opacity: 1;
    }

    .runtime-tooltip {
        visibility: hidden;
        position: absolute;
        bottom: 100%;
        right: 0;
        background-color: #1e293b;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        padding: 8px 12px;
        width: 200px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        z-index: 10;
        opacity: 0;
        transition: opacity 0.2s;
        pointer-events: none;
        margin-bottom: 8px;
    }

    .runtime-info-icon:hover .runtime-tooltip {
        visibility: visible;
        opacity: 1;
    }

    .runtime-tooltip-content {
        text-align: left;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.6;
    }

    .runtime-tooltip-content strong {
        color: rgba(255, 255, 255, 0.4);
        font-weight: normal;
        margin-right: 4px;
    }
</style>