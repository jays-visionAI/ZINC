<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZYNK - Studio</title>
    <meta name="description" content="ZYNK Studio - AI Content Creation Dashboard">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#151f32', 900: '#0f172a', 950: '#020617' },
                        brand: { 500: '#6366f1', 600: '#4f46e5' },
                        accent: { 500: '#10b981' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                },
            },
        };
    </script>
    <link rel="icon" type="image/png" href="../favicon.png">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="studio.css">

    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="report-visualizer.js"></script>

    <meta name="theme-color" content="#0A0A0F">
</head>

<body class="studio-body">
    <!-- Studio Header -->
    <header class="studio-header">
        <div class="studio-header-left">
            <a href="../command-center.html" class="studio-back-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"></path>
                </svg>
            </a>
            <!-- Dynamic Studio Header -->
            <div id="studio-header-container"></div>
        </div>

        <div class="studio-header-center">
            <!-- Project & Agent Team Selector -->
            <div class="studio-selector-group">
                <div class="studio-selector">
                    <label>Project</label>
                    <select id="project-select">
                        <option value="">Select Project...</option>
                    </select>
                </div>
                <!-- Hidden selector for compatibility with legacy scripts -->
                <select id="agentteam-select" style="display: none;"></select>
            </div>
        </div>

        <div class="flex items-center gap-4">
            <button id="booster-toggle-btn" class="booster-btn" title="Activate Booster Mode (Max Performance)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z">
                    </path>
                    <path
                        d="M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z">
                    </path>
                    <path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path>
                    <path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path>
                </svg>
                <span>BOOST</span>
            </button>
            <div id="header-controls-container"></div>

            <div class="studio-timer" id="studio-timer">
                <span class="timer-dot"></span>
                <span>00:00</span>
            </div>
            <button class="studio-close-btn" onclick="window.location.href='../command-center.html'">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
    </header>

    <!-- Main 3-Panel Layout -->
    <main class="studio-main">
        <!-- LEFT PANEL: Workflow Config -->
        <aside class="studio-panel studio-panel-left">
            <!-- Session History (Chat History - Now FIRST) -->
            <div class="panel-section session-section"
                style="margin-top: 10px; flex-shrink: 0; background: rgba(139, 92, 246, 0.03); padding: 12px 8px; border-radius: 12px; border: 1px solid rgba(139, 92, 246, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h3 class="panel-title"
                        style="font-size: 11px; color: #8B5CF6; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; gap: 6px;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        Chat History
                    </h3>
                    <button id="btn-new-session" onclick="createNewSession()"
                        style="background: #8B5CF6; border: none; border-radius: 6px; padding: 4px 10px; color: #fff; font-size: 10px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 4px; box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);">
                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="3">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        New
                    </button>
                </div>
                <div id="session-list-container"
                    style="display: flex; flex-direction: column; gap: 6px; max-height: 200px; overflow-y: auto; padding-right: 4px;">
                    <div class="session-empty-state"
                        style="color: #666; font-size: 11px; padding: 12px; text-align: center; border: 1px dashed rgba(255,255,255,0.05); border-radius: 8px;">
                        No previous sessions
                    </div>
                </div>
            </div>

            <!-- Source Context History (Now SECOND) -->
            <div class="panel-section history-section" style="margin-top: 24px; flex-shrink: 0;">
                <h3 class="panel-title"
                    style="font-size: 11px; color: #666; margin-bottom: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                    Context History</h3>
                <div id="source-context-display" class="source-display-box"
                    style="display:flex; flex-direction:column; gap:8px; max-height:180px; overflow-y:auto; padding-right: 4px;">
                    <!-- Dynamically populated by studio.js -->
                </div>
            </div>

            <!-- FINAL CONTEXT: Briefing Board (New Implementation) -->
            <div class="panel-section briefing-section"
                style="margin-top: 24px; flex: 1; display: flex; flex-direction: column; min-height: 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h3 class="panel-title"
                        style="font-size: 11px; color: #fff; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; gap: 6px;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="color: #00FFA3;">
                            <circle cx="12" cy="12" r="10" />
                            <circle cx="12" cy="12" r="6" />
                            <circle cx="12" cy="12" r="2" />
                        </svg> Target Brief
                    </h3>
                    <span id="brief-sync-indicator"
                        style="font-size: 9px; color: #00FFA3; opacity: 0; transition: opacity 0.5s;">Synced</span>
                </div>

                <div class="briefing-board-container"
                    style="flex: 1; min-height: 0; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; transition: all 0.3s ease;">
                    <textarea id="final-context-editor"
                        placeholder="Your finalized content strategy will appear here. AI will use this as the ultimate reference."
                        style="flex: 1; width: 100%; background: transparent; border: none; color: rgba(255,255,255,0.9); font-size: 13px; line-height: 1.6; padding: 16px; outline: none; resize: none; overflow-y: auto; font-family: 'Inter', sans-serif;"></textarea>

                    <div
                        style="padding: 10px 16px; background: rgba(255,255,255,0.02); border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center;">
                        <span id="brief-char-count" style="font-size: 10px; color: #666;">0 characters</span>
                        <div style="display: flex; gap: 8px;">
                            <button id="btn-clear-brief" title="Clear Brief"
                                style="background: transparent; border: none; color: #666; cursor: pointer; padding: 2px;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2.5">
                                    <path
                                        d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Section -->
            <div class="panel-section stats-section"
                style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.05);">
                <div class="stats-grid" style="display: flex; gap: 10px; font-size: 11px; color: #666;">
                    <div class="stat-box" style="display: flex; gap: 4px;">
                        <span class="stat-label">Agents:</span>
                        <span class="stat-value" id="stats-agents" style="color: #888;">Auto</span>
                    </div>
                    <div class="stat-box" style="display: flex; gap: 4px;">
                        <span class="stat-label">Est. Time:</span>
                        <span class="stat-value" id="stats-time" style="color: #888;">-- min</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- CENTER PANEL: Orchestrator Chat Engine -->
        <section class="studio-panel studio-panel-center" id="center-panel-engine">
            <!-- 1. Header: Project & Mode -->
            <div class="engine-header">
                <div class="project-info">
                    <span class="project-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #60A5FA;">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                        </svg>
                    </span>
                    <span class="project-name" id="current-project-name">Select Project...</span>
                </div>
                <div class="mode-switcher">
                    <button class="mode-btn active" data-mode="agent">Orchestrator</button>
                    <button class="mode-btn" data-mode="social">Social Media</button>
                </div>
            </div>

            <!-- 2. Main Scroll Area: Stream -->
            <div class="engine-stream-container" id="chat-stream-container">

                <!-- A. Plan Card Widget (Hidden by default, shown when plan exists) -->
                <div id="plan-card-widget" class="plan-card" style="display:none;">
                    <div class="plan-header">
                        <span class="plan-title">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                style="vertical-align: middle; margin-right: 6px;">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                                <line x1="16" y1="2" x2="16" y2="6" />
                                <line x1="8" y1="2" x2="8" y2="6" />
                                <line x1="3" y1="10" x2="21" y2="10" />
                            </svg>
                            Execution Plan</span>
                        <span class="plan-badge-auto">Auto-Running</span>
                        <button class="plan-toggle-btn" onclick="togglePlanDetails()">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m6 9 6 6 6-6" />
                            </svg>
                        </button>
                    </div>
                    <div class="plan-body" id="plan-steps-list">
                        <!-- Dynamic Steps will be injected here -->
                    </div>
                </div>

                <!-- B. Welcome / Empty State -->
                <div id="engine-welcome-state" class="engine-welcome">
                    <div class="welcome-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#FBBF24" stroke-width="1.5"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 3l1.91 5.89L20 10l-5.89 1.91L12 18l-1.91-5.89L4 10l5.89-1.91z" />
                        </svg>
                    </div>
                    <h3>Orchestrator AI: Let's Build & Generate</h3>
                    <p>Build your "Target Brief" here or command agent teams to execute workflows.</p>
                </div>

                <!-- C. Chat Stream (Logs & Messages) -->
                <div id="chat-stream-log" class="chat-log-area" style="padding-bottom: 120px;">
                    <!-- Dynamic Messages & MCP Chips go here -->
                </div>

                <!-- 3. Unified Command Bar (Bottom Fixed) - MOVED OUTSIDE of log area -->
                <div class="main-instruction-container" id="command-bar" style="
                    position: absolute; 
                    bottom: 24px; 
                    left: 50%; 
                    transform: translateX(-50%); 
                    width: 90%; 
                    max-width: 800px; 
                    background: rgba(20, 20, 25, 0.95); 
                    backdrop-filter: blur(24px); 
                    border: 1px solid rgba(255, 255, 255, 0.1); 
                    border-radius: 16px; 
                    padding: 12px; 
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); 
                    z-index: 100;
                    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                ">
                    <!-- File Preview Area (Added dynamically) -->
                    <div id="command-preview-area"
                        style="display: none; align-items: center; gap: 10px; padding: 4px 4px 12px 4px; overflow-x: auto; border-bottom: 1px solid rgba(255,255,255,0.05); margin-bottom: 8px;">
                        <!-- Thumbnails will be injected here -->
                    </div>

                    <div class="input-wrapper"
                        style="display: flex; align-items: flex-end; gap: 12px; position: relative;">

                        <!-- Attachments (Left) -->
                        <div class="input-actions-left"
                            style="display: flex; align-items: center; gap: 4px; padding-bottom: 6px;">
                            <button id="btn-toggle-attachments" onclick="toggleAttachmentMenu()" title="Add context"
                                style="
                                            width: 36px; 
                                            height: 36px; 
                                            border-radius: 8px; 
                                            border: none; 
                                            background: transparent; 
                                            color: #ccc; 
                                            cursor: pointer; 
                                            display: flex; 
                                            align-items: center; 
                                            justify-content: center; 
                                            transition: all 0.2s;
                                        ">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>

                            <!-- Attachment Menu (Absolute Popup) -->
                            <div id="attachment-menu" class="attachment-menu" style="
                                        display: none;
                                        position: absolute;
                                        bottom: 60px;
                                        left: 0;
                                        background: #25252b;
                                        border: 1px solid rgba(255,255,255,0.1);
                                        border-radius: 16px;
                                        padding: 10px 6px;
                                        width: 195px;
                                        box-shadow: 0 15px 40px rgba(0,0,0,0.8);
                                        z-index: 200;
                                        animation: menuSlideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                                    ">
                                <div
                                    style="padding: 8px 12px 14px 12px; color: #888; font-size: 14px; font-weight: 600; border-bottom: 1px solid rgba(255,255,255,0.05); margin-bottom: 8px;">
                                    Add context</div>

                                <div class="menu-item" onclick="triggerAttachment('image')"
                                    style="padding: 12px 14px; display: flex; align-items: center; gap: 14px; color: #fff; cursor: pointer; border-radius: 10px; transition: all 0.2s; font-size: 15px; font-weight: 500;">
                                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                        style="color: #eee;">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21 15 16 10 5 21"></polyline>
                                    </svg>
                                    <span>Image</span>
                                </div>

                                <div class="menu-item" onclick="triggerAttachment('file')"
                                    style="padding: 12px 14px; display: flex; align-items: center; gap: 14px; color: #fff; cursor: pointer; border-radius: 10px; transition: all 0.2s; font-size: 15px; font-weight: 500;">
                                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                        style="color: #eee;">
                                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                                        <polyline points="13 2 13 9 20 9"></polyline>
                                    </svg>
                                    <span>File</span>
                                </div>

                                <div class="menu-item" onclick="triggerAttachment('mention')"
                                    style="padding: 12px 14px; display: flex; align-items: center; gap: 14px; color: #fff; cursor: pointer; border-radius: 10px; transition: all 0.2s; font-size: 15px; font-weight: 500;">
                                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                        style="color: #eee;">
                                        <circle cx="12" cy="12" r="4"></circle>
                                        <path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"></path>
                                    </svg>
                                    <span>Mention</span>
                                </div>
                            </div>

                            <style>
                                @keyframes menuSlideUp {
                                    from {
                                        transform: translateY(10px);
                                        opacity: 0;
                                    }

                                    to {
                                        transform: translateY(0);
                                        opacity: 1;
                                    }
                                }

                                .menu-item:hover {
                                    background: rgba(255, 255, 255, 0.08);
                                }

                                .menu-item:hover svg {
                                    color: #fff !important;
                                }

                                #btn-toggle-attachments:hover {
                                    color: #fff !important;
                                    background: rgba(255, 255, 255, 0.05);
                                }

                                #btn-toggle-attachments.active {
                                    background: rgba(255, 255, 255, 0.1) !important;
                                    color: #fff !important;
                                }
                            </style>

                            <!-- Hidden File Inputs -->
                            <input type="file" id="input-image-upload" accept="image/*" style="display: none;"
                                onchange="handleFileSelection(this, 'image')" multiple>
                            <input type="file" id="input-file-upload" accept=".pdf,.doc,.docx,.txt,.md"
                                style="display: none;" onchange="handleFileSelection(this, 'file')" multiple>
                        </div>

                        <!-- Main Text Area -->
                        <textarea id="main-instruction-input"
                            placeholder="Define your content goal or refine the Target Brief..."
                            style="flex: 1; min-height: 24px; max-height: 150px; background: transparent; border: none; color: white; font-size: 15px; line-height: 1.5; outline: none; resize: none; overflow-y: auto; padding: 10px 0;"></textarea>

                        <!-- Right Actions (Voice & Run) -->
                        <div class="input-actions-right"
                            style="display: flex; align-items: center; gap: 8px; padding-bottom: 4px;">

                            <!-- Language Select (Expanded to 20) -->
                            <select id="select-voice-lang" onchange="window.setVoiceLanguage(this.value)"
                                style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: #888; cursor: pointer; padding: 2px 4px; border-radius: 4px; font-size: 10px; font-weight: 600; outline: none; height: 24px;">
                                <option value="ko-KR">KO (Korean)</option>
                                <option value="en-US">EN (English)</option>
                                <option value="ja-JP">JA (Japanese)</option>
                                <option value="zh-CN">ZH (Chinese)</option>
                                <option value="es-ES">ES (Spanish)</option>
                                <option value="fr-FR">FR (French)</option>
                                <option value="de-DE">DE (German)</option>
                                <option value="it-IT">IT (Italian)</option>
                                <option value="ru-RU">RU (Russian)</option>
                                <option value="pt-PT">PT (Portuguese)</option>
                                <option value="hi-IN">HI (Hindi)</option>
                                <option value="ar-SA">AR (Arabic)</option>
                                <option value="bn-IN">BN (Bengali)</option>
                                <option value="ur-PK">UR (Urdu)</option>
                                <option value="id-ID">ID (Indonesian)</option>
                                <option value="vi-VN">VI (Vietnamese)</option>
                                <option value="tr-TR">TR (Turkish)</option>
                                <option value="th-TH">TH (Thai)</option>
                                <option value="tl-PH">TL (Tagalog)</option>
                                <option value="mr-IN">MR (Marathi)</option>
                            </select>

                            <!-- Voice Button -->
                            <button id="btn-voice-input" onclick="toggleVoiceInput()" class="btn-voice"
                                style="width: 32px; height: 32px; border-radius: 50%; border: none; background: rgba(255,255,255,0.05); color: #aaa; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                    <line x1="12" y1="19" x2="12" y2="23"></line>
                                    <line x1="8" y1="23" x2="16" y2="23"></line>
                                </svg>
                            </button>

                            <!-- Smart Action Button -->
                            <button id="btn-send-instruction" title="Start / Regenerate"
                                style="width: 42px; height: 42px; border-radius: 12px; border: none; background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4); transition: all 0.2s;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"></path>
                                </svg>
                            </button>

                        </div>
                    </div>
                </div>
        </section>


        <!-- RIGHT PANEL: Social Media Editor -->
        <aside class="studio-panel studio-panel-right" id="right-panel-editor">

            <!-- 1. Editor Toolbar -->
            <div class="editor-toolbar">
                <div class="toolbar-left">
                    <button class="tool-btn active" title="Preview Mode">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                    <button class="tool-btn" id="btn-code-view" onclick="toggleCodeView()" title="Code View">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-right">
                    <button class="tool-btn" id="btn-edit-mode" title="Edit Content">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                    <button class="action-btn-secondary btn-export">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export
                    </button>
                </div>
            </div>

            <!-- 2. Channel Tabs & View All Link -->
            <!-- 2. Channel Tabs & View All Link -->
            <div class="editor-tabs-wrapper">
                <div class="editor-channel-tabs" id="channel-preview-tabs">
                    <!-- Tabs will be injected here -->
                    <div class="tab-placeholder">Select a channel...</div>
                </div>
                <button id="view-all-channels-btn" onclick="openMultiChannelOverview()" class="view-all-link">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    <span>Multi-channel View</span>
                </button>
            </div>

            <!-- 3. Main Editor Canvas -->
            <div class="editor-canvas-container" id="editor-canvas">
                <!-- Content Area -->
                <div class="canvas-content" id="single-channel-preview">
                    <!-- Default Placeholder -->
                    <div class="preview-placeholder">
                        <div class="placeholder-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                style="color: rgba(255,255,255,0.1);">
                                <rect x="5" y="2" width="14" height="20" rx="2" ry="2" />
                                <line x1="12" y1="18" x2="12" y2="18" />
                            </svg>
                        </div>
                        <p>Waiting for generated content...</p>
                    </div>
                </div>

                <!-- Hidden Code Editor -->
                <textarea id="code-editor-area" style="display: none;"></textarea>
            </div>

        </aside>
    </main>

    <!-- Footer Controls -->
    <footer class="studio-footer">
        <div class="footer-left">
            <!-- Buttons removed per user request -->
        </div>
        <div class="footer-center">
            <span id="footer-progress">Phase --/-- • Agent --/--</span>
        </div>
        <div class="footer-right">
            <button id="retry-btn" class="footer-btn" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                </svg>
                Retry
            </button>
            <button id="complete-btn" class="footer-btn btn-success" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Complete
            </button>
        </div>
    </footer>

    <!-- Agent Report Modal -->
    <div id="agent-report-modal" class="modal-backdrop" style="display: none;">
        <div class="modal-content report-modal">
            <div class="modal-header">
                <h3 class="modal-title flex items-center gap-2">
                    <span id="report-agent-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="11" width="18" height="10" rx="2" />
                            <circle cx="12" cy="5" r="2" />
                            <path d="M12 7v4" />
                            <line x1="8" y1="16" x2="8" y2="16" />
                            <line x1="16" y1="16" x2="16" y2="16" />
                        </svg>
                    </span>
                    <span id="report-agent-name">Agent Report</span>
                </h3>
                <button class="modal-close-btn" onclick="closeAgentReport()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="report-stats-bar">
                    <div class="stat-item">
                        <span class="value" id="report-model">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">Tokens:</span>
                        <span class="value" id="report-tokens">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">Resources:</span>
                        <span class="value" id="report-resource-count">0</span>
                    </div>
                </div>

                <!-- D3 Visualization Container -->
                <div id="report-vis-container" class="report-vis-container">
                    <!-- Graph will be rendered here -->
                </div>

                <!-- Reference Details -->
                <div class="report-details">
                    <h4 class="details-title">Reference Details</h4>
                    <ul id="report-details-list" class="details-list">
                        <!-- List items -->
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="closeAgentReport()">Close Report</button>
            </div>
        </div>
    </div>

    <!-- Market Research Details Modal -->
    <div id="market-research-modal" class="modal-overlay" style="display: none;">
        <div class="modal-container"
            style="max-width: 700px; width: 90%; background: #0f0f13; border: 1px solid rgba(0, 255, 163, 0.2); box-shadow: 0 0 40px rgba(0, 255, 163, 0.1); border-radius: 16px;">
            <div class="modal-header"
                style="border-bottom: 1px solid rgba(255,255,255,0.05); padding: 20px 24px; display: flex; justify-content: space-between; align-items: center;">
                <h3 class="modal-title flex items-center gap-2" style="color: var(--color-cyan);">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                        stroke-linecap="round" stroke-linejoin="round" style="color: #00FFA3;">
                        <circle cx="12" cy="12" r="10" />
                        <circle cx="12" cy="12" r="6" />
                        <circle cx="12" cy="12" r="2" />
                    </svg>
                    <span id="research-modal-title">Market Research Overview</span>
                </h3>
                <button class="modal-close-btn" onclick="closeMarketResearchModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body"
                style="padding: 24px; color: rgba(255,255,255,0.8); line-height: 1.6; max-height: 70vh; overflow-y: auto;">
                <div id="research-modal-content">
                    <!-- Research findings will be injected here -->
                </div>
            </div>
            <div class="modal-footer"
                style="padding: 20px 24px; border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: flex-end;">
                <button class="btn-primary" onclick="closeMarketResearchModal()" style="min-width: 120px;">Got
                    it</button>
            </div>
        </div>
    </div>

    <!-- Agent Team Settings Modal (Unified with Mission Control) - 100% Identical -->
    <div id="agent-settings-modal" class="modal-overlay" style="display: none;">
        <div class="modal-container"
            style="max-width: 800px; width: 90%; background: #13131a; border: 1px solid rgba(255,255,255,0.1); max-height: 85vh; display: flex; flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border-radius: 16px;">
            <div class="modal-header"
                style="flex-shrink: 0; border-bottom: 1px solid rgba(255,255,255,0.05); padding: 20px 24px; display: flex; justify-content: space-between; align-items: center;">
                <h3 class="modal-title" style="margin: 0; font-size: 20px; font-weight: 600;">Agent Team Settings</h3>
                <button class="modal-close" onclick="closeAgentSettingsModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" style="overflow-y: auto; flex: 1; padding: 24px;">
                <div class="form-group">
                    <label class="form-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            style="color: #10B981; vertical-align: middle; margin-right: 6px;">
                            <circle cx="12" cy="12" r="10" />
                            <polyline points="12 16 12 12 15 11" />
                            <path d="m19.07 4.93-1.41 1.41" />
                            <path d="M10.89 2.1 12 4l1.11-1.9" />
                            <path d="m19.07 19.07-1.41-1.41" />
                            <path d="M21.9 10.89 20 12l1.9 1.11" />
                            <path d="m4.93 19.07 1.41-1.41" />
                            <path d="M2.1 13.11 4 12 2.1 10.89" />
                            <path d="m4.93 4.93 1.41 1.41" />
                        </svg>
                        Active Directive (Team Goal)</label>
                    <textarea id="setting-directive" class="form-input" rows="3"
                        placeholder="e.g., Increase brand awareness by posting daily news about AI trends..."></textarea>
                    <div class="form-helper" style="color: rgba(255,255,255,0.5);">Target specific goals for the entire
                        team to focus on.</div>
                </div>

                <div class="form-section-divider"
                    style="height: 1px; background: rgba(255,255,255,0.1); margin: 24px 0;"></div>

                <div class="form-group">
                    <label class="form-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            style="color: #8B5CF6; vertical-align: middle; margin-right: 6px;">
                            <rect x="3" y="11" width="18" height="10" rx="2" />
                            <circle cx="12" cy="5" r="2" />
                            <path d="M12 7v4M8 16h0M16 16h0" />
                        </svg>
                        Sub-Agents Configuration</label>
                    <div class="form-helper" style="margin-bottom: 12px; color: rgba(255,255,255,0.5);">Fine-tune the
                        behavior and personality of each agent.</div>
                    <div id="setting-subagents-list" style="display: flex; flex-direction: column; gap: 16px;">
                        <!-- Dynamic Sub-Agents -->
                        <div class="loading-state">Loading sub-agents...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"
                style="flex-shrink: 0; border-top: 1px solid rgba(255,255,255,0.08); background: #13131a; padding: 20px 24px; display: flex; justify-content: center; gap: 16px;">
                <button class="btn-secondary" onclick="closeAgentSettingsModal()"
                    style="flex: 1; max-width: 200px; padding: 12px 24px; border-radius: 10px;">Cancel</button>
                <button class="btn-primary" onclick="saveAgentSettings()"
                    style="flex: 1; max-width: 200px; padding: 12px 24px; border-radius: 10px;">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- Config & Auth -->
    <script src="../firebase-config.js"></script>
    <script src="../translations.js"></script>
    <script src="../env-config.js"></script>
    <script src="../auth.js"></script>

    <!-- Services -->
    <script src="../services/llm-router-service.js"></script>
    <script src="../services/session-history-service.js"></script>

    <!-- Studio Scripts -->
    <script src="../utils-channel-profiles.js"></script>
    <script src="dag-executor.js"></script>
    <script src="studio.js?v=unified_brain_v2"></script>

    <!-- ZYNK AI Chatbot -->
    <link rel="stylesheet" href="../chatbot.css">
    <button id="chatbot-fab" class="chatbot-fab" aria-label="Open ZYNK Assistant">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </button>
    <div id="chatbot-panel" class="chatbot-panel">
        <div class="chatbot-header">
            <div class="chatbot-header-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#8B5CF6" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="10" rx="2" />
                    <circle cx="12" cy="5" r="2" />
                    <path d="M12 7v4M8 16h0M16 16h0" />
                </svg>
            </div>
            <div class="chatbot-header-info">
                <p class="chatbot-header-title">ZYNK Assistant</p>
                <small class="chatbot-header-subtitle">AI 헬프데스크</small>
            </div>
            <span id="chatbot-usage" class="chatbot-usage-badge">0/50</span>
            <button id="chatbot-close" class="chatbot-close-btn" aria-label="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M18 6 6 18"></path>
                    <path d="m6 6 12 12"></path>
                </svg>
            </button>
        </div>
        <div id="chatbot-messages" class="chatbot-messages"></div>
        <div class="chatbot-input-area">
            <input type="text" id="chatbot-input" class="chatbot-input" placeholder="ZYNK에 대해 물어보세요..." />
            <button id="chatbot-send" class="chatbot-send-btn" aria-label="Send">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="m22 2-7 20-4-9-9-4Z"></path>
                    <path d="M22 2 11 13"></path>
                </svg>
            </button>
        </div>
    </div>
    <script src="../chatbot-v2.js"></script>

    <!-- UI Loader -->
    <script src="../utils-ui-config.js"></script>
    <script src="../utils-ui-loader.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof UI !== 'undefined') {
                UI.renderHeader('studio-header-container', 'studio');
            }
        });
    </script>

    <!-- Image Lightbox Modal -->
    <div id="image-lightbox" onclick="closeLightbox()" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(10px);
        z-index: 9999;
        cursor: zoom-out;
        align-items: center;
        justify-content: center;
        padding: 40px;
        animation: fadeIn 0.2s ease-out;
    ">
        <img id="lightbox-img" src="" style="
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        " onclick="event.stopPropagation()">
        <button onclick="closeLightbox()" style="
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        ">&times;</button>
    </div>
</body>

</html>