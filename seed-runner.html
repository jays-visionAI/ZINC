<!DOCTYPE html>
<html>

<head>
    <title>Seeding Registry...</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>
</head>

<body>
    <h1>Seeding Registry... Check Console</h1>
    <div id="status">Topical...</div>
    <script>
        (async function () {
            const statusDiv = document.getElementById('status');
            try {
                if (!firebase.apps.length) {
                    statusDiv.innerHTML = "Firebase not initialized!";
                    return;
                }
                const db = firebase.firestore();
                const coreAgents = [
                    { id: "INT-MKT-SCOUT", name: "Market Scout", category: "Intelligence", status: "active", currentVersion: "v1.0.0", description: "Surveys external market data, trends, and competitor activities." },
                    { id: "INT-KB-RAG", name: "Knowledge Agent (RAG)", category: "Intelligence", status: "active", currentVersion: "v1.0.0", description: "Retrieves specific chunks from the internal Knowledge Hub." },
                    { id: "DSN-NRV-DSGN", name: "Narrative Designer", category: "Design", status: "active", currentVersion: "v1.0.0", description: "Structures the storyline and content flow." },
                    { id: "DSN-VIS-DIR", name: "Visual Director", category: "Design", status: "active", currentVersion: "v1.0.0", description: "Defines the aesthetic guidelines and palettes." },
                    { id: "DSN-STR-ARCH", name: "Structure Architect", category: "Design", status: "active", currentVersion: "v1.0.0", description: "Architects the JSON layout structure." },
                    { id: "QA-VIS-QC", name: "Aesthetic Critic (Vision)", category: "QA", status: "active", currentVersion: "v1.0.0", description: "Uses Vision AI to critique screenshots." },
                    { id: "QA-REV-HND", name: "Revision Handler", category: "QA", status: "active", currentVersion: "v1.0.0", description: "Interprets feedback for surgical edits." },
                    { id: "STG-DECK-MSTR", name: "Pitch Deck Strategist", category: "Strategy", status: "active", currentVersion: "v1.0.0", description: "Master strategist for pitch decks." },
                    { id: "STG-ONE-PAGER", name: "One Pager Strategist", category: "Strategy", status: "active", currentVersion: "v1.0.0", description: "Specialist in one-pagers." }
                ];

                const batch = db.batch();
                const timestamp = firebase.firestore.FieldValue.serverTimestamp();

                coreAgents.forEach(agent => {
                    const regRef = db.collection("agentRegistry").doc(agent.id);
                    batch.set(regRef, {
                        ...agent,
                        createdAt: timestamp,
                        updatedAt: timestamp,
                        currentProductionVersion: "v1.0.0"
                    });

                    // Use deterministic ID for v1.0.0 to prevent duplicates during multiple seed runs
                    const verRef = db.collection("agentVersions").doc(`${agent.id}-v1-0-0`);
                    batch.set(verRef, {
                        agentId: agent.id,
                        version: "1.0.0",
                        isProduction: true,
                        status: "production",
                        config: { model: "deepseek-reasoner", temperature: 0.7 },
                        systemPrompt: `You are ${agent.name}. ${agent.description}`,
                        changelog: "Initial seed",
                        createdAt: timestamp
                    });
                });

                await batch.commit();
                statusDiv.innerHTML = "✅ SUCCESS: Seeding Complete!";
                console.log("Seeding Complete");
            } catch (e) {
                statusDiv.innerHTML = "❌ ERROR: " + e.message;
                console.error(e);
            }
        })();
    </script>
</body>

</html>